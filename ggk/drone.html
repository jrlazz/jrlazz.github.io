<!DOCTYPE html>
<html lang="en">
<head>
<title>drone.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>
body{background-color:#024;color:#fc0;margin:0px;overflow:hidden;}
span{position:absolute;top:10px;width:100%;text-align:center;font-family:Lucida Console;}
a{color:#0ff;text-decoration:none;font-size:10pt;}
</style>

<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
	{
		"imports":{
			"three":"https://unpkg.com/three@0.155.0/build/three.module.js",
			"three/addons/":"https://unpkg.com/three@0.155.0/examples/jsm/"
		}
	}
</script>


</head>

<body>

<span id="sp"></span>

<script type="module">

import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { STLLoader } from 'three/addons/loaders/STLLoader.js';

var controls,camera,scene,renderer,loader,Earth,lightA,lightP;
var w=0;
var ww=0;

var mesh=[];
var prop=[];
var axe=[];
var gProps=new THREE.Group();
var gBalls=new THREE.Group();
var gAll=new THREE.Group();
var key;
var giro=0;
var tecL=0;var tecR=0;var tecW=0;var tecS=0;var tecU=0;var tecD=0;


function init() {

	camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1000);
	camera.position.set(0,5,20);

	renderer=new THREE.WebGLRenderer({antialias:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(window.innerWidth,window.innerHeight);
	document.body.appendChild(renderer.domElement);

	scene=new THREE.Scene();
	scene.background=new THREE.Color('#024');

	lightA=new THREE.AmbientLight('#fff',1);

	lightP=new THREE.PointLight('#fff',8000);lightP.position.set(30,0,0);

	//Earth
	Earth=new THREE.TextureLoader().load("img/earth_800.jpg");
	mesh[11]=new THREE.Mesh(new THREE.SphereGeometry(2.3,24,24),new THREE.MeshStandardMaterial({color:'#ccc',map:Earth,metalness:0.8}));

	//Propellers
	loader=new STLLoader();
	
	loader.load('models/extras/prop_U.stl',function (geometry){
		prop[1]=new THREE.Mesh(geometry,new THREE.MeshNormalMaterial());
		prop[1].position.set(-3.04,-0.17,0);
		prop[1].scale.set(0.4,0.4,0.4);

		prop[3]=new THREE.Mesh(geometry,new THREE.MeshNormalMaterial());//BasicMaterial({color:'#f00'}));
		prop[3].position.set(3.04,-0.17,0);
		prop[3].scale.set(0.4,0.4,0.4);


	} );

	loader.load('models/extras/prop_D.stl',function (geometry){
		prop[2]=new THREE.Mesh(geometry,new THREE.MeshNormalMaterial());
		prop[2].position.set(0,-0.17,3.04);
		prop[2].scale.set(0.4,0.4,0.4);

		prop[4]=new THREE.Mesh(geometry,new THREE.MeshNormalMaterial());//BasicMaterial({color:'#ff0'}));
		prop[4].position.set(0,-0.17,-3.04);
		prop[4].scale.set(0.4,0.4,0.4);
	} );

	//Rings
	loader.load( 'models/extras/anel_in.stl',function (geometry){
		mesh[13]=new THREE.Mesh(geometry,new THREE.MeshStandardMaterial({color:'#c90',metalness:0.8,roughness:0.4}));
	} );
	loader.load( 'models/extras/anel_out.stl',function (geometry){
		mesh[23]=new THREE.Mesh(geometry,new THREE.MeshNormalMaterial({side:THREE.DoubleSide}));
	} );
	
	//Balls
	axe[1]=new THREE.AxesHelper(0.1);
	mesh[14]=new THREE.Mesh(new THREE.SphereGeometry(0.05,32,32),new THREE.MeshStandardMaterial({color:'#960'}));
	mesh[14].position.set(-2.96,0,0);
	axe[1].add(mesh[14]);
	gBalls.add(axe[1]);
	for(let z=2;z<91;z++){axe[z]=axe[1].clone();axe[z].rotation.y=z*0.1;gBalls.add(axe[z]);}

	//Arms
	mesh[15]=new THREE.Mesh(new THREE.CylinderGeometry(0.05,0.05,5.8,8,8,false),new THREE.MeshStandardMaterial({color:'#c90'}));
	mesh[15].position.set(0,0,0);
	mesh[15].rotation.set(Math.PI/2,0,Math.PI/2);
		mesh[16]=new THREE.Mesh(new THREE.CylinderGeometry(0.05,0.05,5.8,8,8,false),new THREE.MeshStandardMaterial({color:'#c90'}));
		mesh[16].position.set(0,0,0);
		mesh[16].rotation.set(Math.PI/2,0,0);
	mesh[11].add(mesh[15]);mesh[11].add(mesh[16]);


	controls=new OrbitControls(camera,renderer.domElement);
	controls.enableRotate=false;

	window.addEventListener('resize',onWindowResize);
	onWindowResize();
}

function onWindowResize(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate(){
	requestAnimationFrame(animate);

	if(w<5){ww++;document.getElementById("sp").innerHTML="Please Wait..."}

	if(mesh[11] && mesh[13] && mesh[23] && prop[1] && prop[2] && prop[3] && prop[4]){w++;};

	if(w==10){
		scene.add(lightA);scene.add(lightP);
		document.getElementById("sp").innerHTML="<font style='font-size:16pt;'>Earth drone <a href='drone.txt' target='_blank'>code</a></font><br>(WASD & arrows)<br><a href='https://www.makerhero.com/blog/o-que-e-como-funciona-um-drone' target='_blank'>... more about drones</a>";
		for(let z=1;z<5;z++){gProps.add(prop[z]);}
		if(gProps){gProps.rotation.y=-Math.PI/4;}
		gAll.add(gProps);
		gAll.add(mesh[11]);
		gAll.add(gBalls);
		gAll.add(mesh[13]);gAll.add(mesh[23]);
		scene.add(gAll);

		prop[5]=prop[1].clone();prop[5].position.set(-16, 4,-2);
		prop[7]=prop[3].clone();prop[7].position.set( 16,-6, 0);
		prop[6]=prop[2].clone();prop[6].position.set(-16,-6, 0);
		prop[8]=prop[4].clone();prop[8].position.set( 16, 4,-2);
		for(let z=5;z<9;z++){if(prop[z]){prop[z].scale.multiplyScalar(1);prop[z].rotation.x=Math.PI/4;;scene.add(prop[z]);}}
	}

	if(prop[1] && prop[2] && prop[3] && prop[4] && prop[5] && prop[6] && prop[7] && prop[8]){giro=1;}

	if(tecW==0 && tecS==0 && giro==1){
		prop[2].rotation.y +=0.2;prop[6].rotation.y +=0.2;
		prop[3].rotation.y -=0.2;prop[7].rotation.y -=0.2;
		prop[1].rotation.y -=0.2;prop[5].rotation.y -=0.2;
		prop[4].rotation.y +=0.2;prop[8].rotation.y +=0.2;
	}

	if(tecS==1 && giro==1){
		prop[2].rotation.y +=0.1;prop[6].rotation.y +=0.1;
		prop[3].rotation.y -=0.1;prop[7].rotation.y -=0.1;
		prop[1].rotation.y -=0.1;prop[5].rotation.y -=0.1;
		prop[4].rotation.y +=0.1;prop[8].rotation.y +=0.1;
	}

	if(tecW==1 && giro==1){
		prop[2].rotation.y +=0.3;prop[6].rotation.y +=0.3;
		prop[3].rotation.y -=0.3;prop[7].rotation.y -=0.3;
		prop[1].rotation.y -=0.3;prop[5].rotation.y -=0.3;
		prop[4].rotation.y +=0.3;prop[8].rotation.y +=0.3;
	}

	if(tecR==1 && giro==1){
		prop[2].rotation.y +=0.3;prop[6].rotation.y +=0.3;
		prop[1].rotation.y -=0.3;prop[5].rotation.y -=0.3;
	}

	if(tecL==1 && giro==1){
		prop[3].rotation.y -=0.3;prop[7].rotation.y -=0.3;
		prop[4].rotation.y +=0.3;prop[8].rotation.y +=0.3;
	}

	if(tecU==1 && giro==1){
		prop[2].rotation.y +=0.3;prop[6].rotation.y +=0.3;
		prop[3].rotation.y -=0.3;prop[7].rotation.y -=0.3;
	}

	if(tecD==1 && giro==1){
		prop[1].rotation.y -=0.3;prop[5].rotation.y -=0.3;
		prop[4].rotation.y +=0.3;prop[8].rotation.y +=0.3;
	}

	if(w>500){w=12;}

	if(gBalls){gBalls.rotation.y +=0.01;}

	if(mesh[11]){mesh[11].rotation.y +=0.01;}

	controls.update();
	renderer.render( scene, camera );
}

var keys=[];
var kArr=[];

window.addEventListener("keydown",function(e){
        keys[e.keyCode]=e.keyCode;
	//alert(e.keyCode);
        kArr=gNArr(keys);
	tecL=0;tecR=0;tecW=0;tecS=0;tecU=0;tecD=0;
	for(var i=0;i<kArr.length;i++){
		if(kArr[i]==37 || kArr[i]==65){tecL=1;gAll.position.x -=0.1;}//left arrow
		if(kArr[i]==39 || kArr[i]==68){tecR=1;gAll.position.x +=0.1;}//right arrow
		if(kArr[i]==87){tecW=1;gAll.position.y +=0.1;}//W
		if(kArr[i]==83){tecS=1;gAll.position.y -=0.1;}//S
		if(kArr[i]==38){tecU=1;gAll.scale.multiplyScalar(0.99);}//up arrow
		if(kArr[i]==40){tecD=1;gAll.scale.multiplyScalar(1.01);}//down arrow
	}
},false);

window.addEventListener('keyup',function(e){
        keys[e.keyCode]=false;
	tecL=0;tecR=0;tecW=0;tecS=0;tecU=0;tecD=0;
	for(var i=0;i<gNArr(keys).length;i++){
		if(gNArr(keys)[i]==37 || gNArr(keys)[i]==65){tecL=1;gAll.position.x -=0.1;}//left arrow
		if(gNArr(keys)[i]==39 || gNArr(keys)[i]==68){tecR=1;gAll.position.x +=0.1;}//right arrow
		if(gNArr(keys)[i]==87){tecW=1;gAll.position.y +=0.1;}//W
		if(gNArr(keys)[i]==83){tecS=1;gAll.position.y -=0.1;}//S
		if(gNArr(keys)[i]==38){tecU=1;gAll.scale.multiplyScalar(0.99);}//up arrow
		if(gNArr(keys)[i]==40){tecD=1;gAll.scale.multiplyScalar(1.01);}//down arrow
	}
},false);

function gNArr(arr){
	var newArr = new Array();
	for(var i=0;i<arr.length;i++){
		if(typeof arr[i]=="number"){
			newArr[newArr.length]=arr[i];
		}
	}
	return newArr;
}

init();

animate();

/*

A very expensive drone

the link...

http://jrlazz.eu5.org/ggk/drone.html


*/

</script>



</body>
</html>
