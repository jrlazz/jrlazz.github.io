<!doctype html>
<html lang="en">
<head>
<title>fire.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="../three.js.ico">
</head>

<body style="background-color:#035;overflow:hidden;">

<script src="jp/Three.js"></script>
<script src="jp/Detector.js"></script>
<script src="jp/OrbitControls.js"></script>
<script src="jp/THREEx.KeyboardState.js"></script>
<script src="jp/THREEx.FullScreen.js"></script>
<script src="jp/THREEx.WindowResize.js"></script>
<script src="jp/ParticleEngine.js"></script>
<script src="jp/jquery-1.9.1.js"></script>
<script src="jp/jquery-ui.js"></script>

<span style="position:absolute;color:#fc0;font-size:16px;z-index:1;">... click right to inspect ...</span>
<span id="spanXY" style="position:absolute;top:30px;left:10px;color:#fc0;font-size:16px;z-index:2;"></span>
<span id="spanX" style="position:absolute;top:10px;left:10%;width:80%;color:#fc0;font-size:16px;z-index:2;text-align:center;"></span>
<div id="ThreeJS" style="position:absolute;left:0px;top:0px"></div>

<script>

// Three.js "tutorials by example" Author: Lee Stemkoski	Date: July 2013 (three.js v59dev)

// ********        ********        ********        ********

var container, scene, camera, renderer, controls;

var mesh, intersection, clicked;

var clock=new THREE.Clock();

var screenH,screenW;
var w=0, wX=0, wY=0, wZ=0, wscreen=0, wp=0, passo=0.5;
var mouse=new THREE.Vector2(1,1);
var intersected=new Array();
var tmat=new Array();
var cube=new Array();
var lineXY=new Array();
var ponto, dice, flower;

var vector=new THREE.Vector3(0,0,1);

// ********        ********        ********        ********

function par(){	
	this.engine=new ParticleEngine();
	engine.setValues(
	Examples={
	fireball:{
		positionStyle:Type.SPHERE,
		positionBase:new THREE.Vector3(wX,wY,wZ),
		positionRadius:2,
		velocityStyle:Type.SPHERE,
		speedBase:40,
		speedSpread:8,
		particleTexture:THREE.ImageUtils.loadTexture('jp/smokeparticle.png'),
		sizeTween:new Tween([0,0.1],[1,150]),
		opacityTween:new Tween([0.7,1],[1,0]),
		colorBase:new THREE.Vector3(0.02,1,0.4),
		blendStyle:THREE.AdditiveBlending,  
		particlesPerSecond:60,
		particleDeathAge:1.5,
		emitterDeathAge:60
	},
	smoke:{
		positionStyle:Type.CUBE,
		positionBase:new THREE.Vector3(wX,wY,wZ),
		positionSpread:new THREE.Vector3(10,0,10 ),
		velocityStyle:Type.CUBE,
		velocityBase:new THREE.Vector3(0,150,0),
		velocitySpread:new THREE.Vector3(80,50,80 ), 
		accelerationBase:new THREE.Vector3(0,-10,0),
		particleTexture:THREE.ImageUtils.loadTexture('jp/smokeparticle.png'),
		angleBase:0,
		angleSpread:720,
		angleVelocityBase:0,
		angleVelocitySpread:720,
		sizeTween:new Tween([0,1],[32,128]),
		opacityTween:new Tween([0.8,2],[0.5,0]),
		colorTween:new Tween([0.4,1],[new THREE.Vector3(0,0,0.2),new THREE.Vector3(0,0,0.5)]),
		particlesPerSecond:200,
		particleDeathAge:2.0,
		emitterDeathAge:60
	}
	}
	);
	engine.initialize();
}


init();
animate();

function init(){

	// SCENE
	scene=new THREE.Scene();

	// CAMERA
	screenW=window.innerWidth;
	screenH=window.innerHeight;
	camera=new THREE.PerspectiveCamera(45,screenW/screenH,2,5000);
	scene.add(camera);
	camera.position.set(0,200,400);
	camera.lookAt(scene.position);
	
	// RENDERER
	renderer=new THREE.WebGLRenderer({antialias:true});
	renderer.setSize(screenW,screenH);
	renderer.setClearColor('#035',1.0);

	container=document.getElementById('ThreeJS');
	container.appendChild(renderer.domElement);
	projector=new THREE.Projector();
	document.addEventListener('mousedown',onMouseDown,false);
	document.addEventListener('mousemove',onMouseMove,false);
	THREEx.WindowResize(renderer, camera);

	// CONTROLS
	controls=new THREE.OrbitControls(camera,renderer.domElement);

	// LIGHT
	var light=new THREE.PointLight(0xffffff,1);
	light.position.set(0,250,0);
	scene.add(light);

	var loader=new THREE.TextureLoader();

	var cubeGeometry=new THREE.CubeGeometry(30,30,30);
	var flowerTexture=new THREE.ImageUtils.loadTexture('../ggk/img/fl2.jpg');
	var flowerMaterial=new THREE.MeshBasicMaterial({map:flowerTexture});
	flower=new THREE.Mesh(cubeGeometry.clone(),flowerMaterial);
	flower.position.set(-60,50,-100);
	flower.name="flower cube";
	scene.add(flower);

	var geoCX=new THREE.CubeGeometry(20,20,20);
	for(let i=1;i<37;i++){
		tmat[i]=new THREE.MeshBasicMaterial({color:Math.random()*0xffffff,transparent:false,map:new THREE.ImageUtils.loadTexture('jp/cin112.png')});
		cube[i]=new THREE.Mesh(geoCX,tmat[i]);cube[i].position.set(Math.random()*200-100,Math.random()*100-50,Math.random()*200-100);cube[i].name="cube " + i;
	}

	var sphereGeometry=new THREE.SphereGeometry(20,32,16); 
	var sphereMaterial=new THREE.MeshLambertMaterial({color:0x8888ff}); 
	var sphere=new THREE.Mesh(sphereGeometry,sphereMaterial);
	sphere.position.set(100,50,-50);
	sphere.name="sphere";
	scene.add(sphere);

	var sun=new THREE.PointLight("#fc9",0.5);
	sun.position.set(-250,80,250);
	scene.add(sun);

	sphereGeoPoint=new THREE.SphereGeometry(10,32,16); 
	sphereMatPoint=new THREE.MeshLambertMaterial({color:0x00ff00,metallic:0.9,roughness:0.2}); 
	ponto=new THREE.Mesh(sphereGeoPoint,sphereMatPoint);
	ponto.position.set(-180,50,200);
	ponto.name="@ponto";
	scene.add(ponto);
/*
	var spotLight=new THREE.SpotLight(0xffffff,2);
	spotLight.position.set(-220,60,250);
	spotLight.angle=Math.PI/6;
	spotLight.penumbra=1;
	spotLight.decay=20;
	spotLight.distance=200;
	spotLight.target=ponto;
	scene.add(spotLight);
	scene.add(spotLight.target);
	var lightHelper=new THREE.SpotLightHelper(spotLight);
	scene.add(lightHelper);
*/
	var materialArray=[];
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl1.jpg')}));
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl2.jpg')}));
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl3.jpg')}));
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl4.jpg')}));
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl5.jpg')}));
	materialArray.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('../ggk/img/fl6.jpg')}));
	var diceMaterial=new THREE.MeshFaceMaterial(materialArray);
	var diceGeom=new THREE.CubeGeometry(30,30,30,1,1,1);
	dice=new THREE.Mesh(diceGeom,diceMaterial);
	dice.position.set(-155,55,45);
	dice.name="flowers dice cube";
	scene.add(dice);

//****************************

par();

//****************************

	// Grid
	var grid=new THREE.GridHelper(320,8);//size,divisions
	grid.material.color=new THREE.Color('#0ac');
	grid.position.set(0,-70,0);
	grid.name="@grid";
	scene.add(grid);

	// Line
	var lineGeometryXY=new THREE.Geometry();
	var vertArrayXY=lineGeometryXY.vertices;
	vertArrayXY.push(new THREE.Vector3(cube[15].position.x,cube[15].position.y,cube[15].position.z),new THREE.Vector3(ponto.position.x,ponto.position.y,ponto.position.z) );
	lineGeometryXY.computeLineDistances();
	var lineMaterialXY=new THREE.LineDashedMaterial({color:0x00ff00,scale:2,dashSize:2,gapSize:2});
	lineXY[1]=new THREE.Line(lineGeometryXY,lineMaterialXY);
	scene.add(lineXY[1]);
	scene.remove(lineXY[1]);

}

function onMouseDown(event){clicked=true;inter();clicked=false;}
function onMouseMove(event){clicked=false;scene.remove(lineXY[1]);inter();}

function inter(){
	if(!clicked){scene.remove(lineXY[1]);}
	document.getElementById("spanX").innerText="";
	mouse.x=(event.clientX/window.innerWidth)*2-1;
	mouse.y=-(event.clientY/window.innerHeight)*2+1;
	//document.getElementById("spanXY").innerText="x="+event.clientX+" y="+event.clientY;
	var vector=new THREE.Vector3(mouse.x,mouse.y,1);
	projector.unprojectVector(vector,camera );
	var ray=new THREE.Raycaster(camera.position,vector.sub(camera.position).normalize());
	var intersects=ray.intersectObjects(scene.children,true);
	if (intersects.length>0){
		if(intersects[0].object.name.substring(0,1)!="@"){
			wX=intersects[0].object.position.x;
			wY=intersects[0].object.position.y;
			wZ=intersects[0].object.position.z;
			if(clicked){
				w=0;
				engine.destroy();
				par();
				restartEngine(Examples.fireball);
				intersected[1]=intersects[0].object;
				//restartEngine(Examples.smoke);
			}else{
				lineGeometryXY=new THREE.Geometry();
				vertArrayXY=lineGeometryXY.vertices;
				vertArrayXY.push(new THREE.Vector3(wX,wY,wZ),new THREE.Vector3(ponto.position.x,ponto.position.y,ponto.position.z));
				lineGeometryXY.computeLineDistances();
				lineMaterialXY=new THREE.LineDashedMaterial({color:0x00ff00,scale:2,dashSize:2,gapSize:2});
				lineXY[1]=new THREE.Line(lineGeometryXY,lineMaterialXY);
				scene.add(lineXY[1]);
			}
		//console.log(intersects[0].object.name);
		//document.getElementById("spanX").innerText=" ... " + intersects[0].object.name + " ... " + wX + " "+ wY + " "+ wZ + " ";
		document.getElementById("spanX").innerText=intersects[0].object.name;
		}
	}
}

function animate(){
	requestAnimationFrame(animate);
	render();
	update();
}

function restartEngine(parameters){
	engine.setValues(parameters);
	engine.initialize();
}

function update(){
	controls.update();
	var dt=clock.getDelta();
	engine.update(dt*0.5);

	w++;
	if(w>30){engine.destroy();scene.remove(intersected[1]);}

	cube[9].rotation.y +=0.02;cube[9].rotation.x +=0.02;
	dice.rotation.z +=0.02;dice.rotation.y +=0.02;dice.rotation.x +=0.02;

	wp++;
	if(wp>15){scene.remove(lineXY[1]);wp=0;}
	ponto.position.x +=passo;
	if(ponto.position.x>180){ponto.position.x=-180;}

	wscreen++;
	if(wscreen==10){for(let i=1;i<37;i++){scene.add(cube[i]);}}
}

function render(){
	renderer.render(scene,camera);
}


/*

Click and burn meshes. Based on Lee Stemkosky's Particle Engine.

Hello Discourse followers...

Here is an experiment based on Lee Stemskosky's Particle Engine wonderfull work.

I think that page is just a start of a big scenario.

Hope You enjoy...

http://jrlazz.eu5.org/fire/fire.html

Jose Roberto Lazzareschi

*/


</script>

<div style="text-align:right;position:fixed;bottom:3px;right:3px;width:100%;z-index:999999;cursor:pointer;line-height:0;display:block;"><a target="_blank" href="https://www.freewebhostingarea.com" title="Free Web Hosting with PHP5 or PHP7"><img alt="Free Web Hosting" src="https://www.freewebhostingarea.com/images/poweredby.png" style="border-width: 0px;width: 180px; height: 45px; float: right;"></a></div>
</body>
</html>
