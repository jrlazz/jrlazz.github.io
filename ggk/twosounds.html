<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>AudioContext &lt; JavaScript &gt;</title>

<style type="text/css">
body{background-color:#bcc; font-family:Arial;}
#analyser{display:flex;align-items:flex-end;margin:1em 0;height:200px;border:1px solid #c00;}
#analyser>div{flex:1;border-top:3px solid green;transition:.05s}

</style>

</head>

<body>

<center>

<h2>https://www.the-art-of-web.com/javascript/creating-sounds/</h2>


<table><tr><td>
<form id="soundForm" style="width: 20%">
<fieldset>
<legend>Sound Player 1</legend>
<label>Frequency</label><span><span id="f1">1</span><input type="range" id="freq" name="freq" value="220" min="220" step="10" max="880" oninput="myPlayer.setFrequency(this.value);" onchange="freqalt();">
<br><label>Volume</label><span><input type="range" name="vol" value="15" min="0" step="1" max="200" oninput="myPlayer.setVolume(this.value/100);"></span>
<br><label>Wave Type</label>
<br><label><input type="radio" name="wave" value="sine" checked="checked" onclick="myPlayer.setWaveType(this.value);"> sine</label><br>
<label><input type="radio" name="wave" value="square" onclick="myPlayer.setWaveType(this.value);"> square</label><br>
<label><input type="radio" name="wave" value="sawtooth" onclick="myPlayer.setWaveType(this.value);"> sawtooth</label><br>
<label><input type="radio" name="wave" value="triangle" onclick="myPlayer.setWaveType(this.value);"> triangle</label>
<br>
<input name="play" type="button" onclick="myPlayer.play(form.freq.value,form.vol.value/100,checkRadio(form.wave));this.style.display='none';form.stop.style.display='inline';" value="Play ►" style="">
<input name="stop" style="display: none;" type="button" onclick="myPlayer.stop();form.play.style='inline';this.style.display='none';" value="Stop ❙❙"></span>
</fieldset>
</form>

</td><td>

<form id="soundForm2" style="width: 20%;">
<fieldset>
<legend>Sound Player 2</legend>
<label>Frequency</label><span id="f2">2</span><input id="freq2" type="range" name="freq2" value="220" min="220" step="10" max="880" oninput="myPlayer2.setFrequency(this.value);" onchange="freqalt();">
<br><label>Volume</label><span><input type="range" name="vol" value="15" min="0" step="1" max="200" oninput="myPlayer2.setVolume(this.value/100);"></span>
<br><label>Wave Type</label><span>
<br><label><input type="radio" name="wave" value="sine" onclick="myPlayer2.setWaveType(this.value);" checked="checked"> sine</label><br>
<label><input type="radio" name="wave" value="square" onclick="myPlayer2.setWaveType(this.value);"> square</label><br>
<label><input type="radio" name="wave" value="sawtooth" onclick="myPlayer2.setWaveType(this.value);"> sawtooth</label><br>
<label><input type="radio" name="wave" value="triangle" onclick="myPlayer2.setWaveType(this.value);"> triangle</label>
<br>
<input name="play" type="button" onclick="myPlayer2.play(form.freq2.value,form.vol.value/100,checkRadio(form.wave));this.style.display='none';form.stop.style.display='inline';" value="Play ►" style="">
<input name="stop" style="display: none;" type="button" onclick="myPlayer2.stop();form.play.style='inline';this.style.display='none';" value="Stop ❙❙">
</fieldset>
</form>

</td></tr></table>
<br>
<div id="analyser" style="width:800px;">
</div>



</center>

<script>

  const checkRadio = (field) => {
    if((typeof field.length == "undefined") && (field.type == "radio")) {
      if(field.checked) return field.value;
    } else {
      for(let i=0; i < field.length; i++) {
        if(field[i].checked) return field[i].value;
      }
    }
    return false;
  };


  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audio = new AudioContext();

  const analyser = audio.createAnalyser();

  let analyserDisplay = document.getElementById("analyser");
  let myPlayer, myPlayer2;
  if(analyser.getFloatTimeDomainData) {
    analyser.fftSize = 512*4;
    analyser.connect(audio.destination);
    myPlayer = new SoundPlayer(audio, analyser);
    myPlayer2 = new SoundPlayer(audio, analyser);
    for(let i=0; i < analyser.fftSize; i++) {
      analyserDisplay.appendChild(document.createElement("DIV"));
    }
    let dataArray = new Float32Array(analyser.fftSize);
    setInterval(function() {
      analyser.getFloatTimeDomainData(dataArray);
      for(let i=0; i < dataArray.length; i++) {
        analyserDisplay.children[i].style.height=(100+((80000*dataArray[i]))/512)+"px";}
    }, 500);
  } else {
    // getFloatTimeDomainData not supported
    myPlayer = new SoundPlayer(audio);
    myPlayer2 = new SoundPlayer(audio);
    analyserDisplay.style.display = "none";
  }

function SoundPlayer(audioContext,filterNode){
	this.audioCtx=audioContext;this.gainNode=this.audioCtx.createGain();
	if(filterNode){
		this.gainNode.connect(filterNode);
	}else{
		this.gainNode.connect(this.audioCtx.destination);
	}
	this.oscillator=null;
}

SoundPlayer.prototype.setFrequency=function(val,when){
	if(when){this.oscillator.frequency.setValueAtTime(val,this.audioCtx.currentTime+when);
		}else{
	this.oscillator.frequency.setValueAtTime(val,this.audioCtx.currentTime);
	}
	return this;
};

SoundPlayer.prototype.setVolume=function(val,when){
	if(when){
		this.gainNode.gain.exponentialRampToValueAtTime(val,this.audioCtx.currentTime+when);
	}else{
		this.gainNode.gain.setValueAtTime(val,this.audioCtx.currentTime);
	}
	return this;
};

SoundPlayer.prototype.setWaveType=function(waveType){
	this.oscillator.type=waveType;return this;
};

SoundPlayer.prototype.play=function(freq,vol,wave,when){
	this.oscillator=this.audioCtx.createOscillator();
	this.oscillator.connect(this.gainNode);this.setFrequency(freq);
	if(wave){
		this.setWaveType(wave);
	}
	this.setVolume(1/1000);
	if(when){
		this.setVolume(1/1000,when-0.02);
	this.oscillator.start(when-0.02);
	this.setVolume(vol,when);
	}else{
		this.oscillator.start();
	this.setVolume(vol,0.02);
	}
	return this;
};

SoundPlayer.prototype.stop=function(when){
	if(when){
		this.gainNode.gain.setTargetAtTime(1/1000,this.audioCtx.currentTime+when-0.05,0.02);
		this.oscillator.stop(this.audioCtx.currentTime+when);
	}else{
		this.gainNode.gain.setTargetAtTime(1/1000,this.audioCtx.currentTime,0.02);
		this.oscillator.stop(this.audioCtx.currentTime+0.05);}return this;
};

function freqalt(){
document.getElementById("f1").innerHTML="&nbsp;"+document.getElementById("freq").value;
document.getElementById("f2").innerHTML="&nbsp;"+document.getElementById("freq2").value;
}

freqalt();
</script>

</html>