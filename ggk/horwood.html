<!DOCTYPE html>
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta charset="utf-8" />

<title>Horwood Piano</title>
<meta name="author" content="Keith William Horwood" />

<style>

body { font-family:Arial; color:rgb(32,32,32); padding:10px; background-color:#bcc;}
input { font-size:12pt; font-weight:bold; color:red;}
select { font-size:12pt; color:#f00; font-weight:bold;}
b { font-weight:bold;}
.key { position:absolute; font-family:Arial; font-weight:100; font-size:12px;
	border:1px solid rgba(32,32,32,0.2);
	border-radius:0px 0px 5px 5px;
	cursor:pointer;
	box-shadow:0px 5px 1px rgba(32,32,32,0.2);
	-webkit-transition:margin 0.05s ease, background-color 0.05s ease, box-shadow 0.05s ease;}
.key:hover { background-color:rgb(255,192,32); }
.key .label { position: absolute; bottom: 5px; text-align:center; left:0px; right:0px;}
.black { background-color:rgb(32,32,32); color:#ffffff; z-index: 1; text-shadow:0px -1px 1px rgba(255,255,255,0.5);}
.white { background-color:#ffffff; color: rgb(32,32,32); z-index: 0; text-shadow:0px 1px 1px rgba(32,32,32,0.5);}
.keyboard-options { margin:0px auto; width:auto; text-align:center; font-size:12px; font-weight:200;}
.keyboard-holder { margin:30px auto; height:200px; position:relative; top:-20px; user-select:none; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none;
-webkit-box-shadow: 35px 52px 48px -29px rgba(84,84,84,1);
-moz-box-shadow: 35px 52px 48px -29px rgba(84,84,84,1);
box-shadow: 35px 52px 48px -29px rgba(84,84,84,1);
}
button {font-family:Arial; font-size:12pt; border:3px output white;border-color:white black black white;}
td{ background-color:#eff; font-size:12pt; color:#00c; border:1px outset #abb; padding:2px; font-weight:bold;}
.tdnada{ background-color:transparent; border:0px;}
a { text-decoration:none; color:#00c;}
</style>

<script src="../js/console.min.js"></script>

<script>

var fnPlayNote="";
var inibe=0;

var Synth, AudioSynth, AudioSynthInstrument;
!function(){
	var _encapsulated = false;
	var AudioSynthInstance = null;
	var pack = function(c,arg){return [String.fromCharCode(arg&255,(arg>>8)&255),String.fromCharCode(arg&255,(arg>>8)&255,(arg>>16)&255,(arg>>24)&255)][c];};
	var setPrivateVar = function(n,v,w,e){Object.defineProperty(this,n,{value:v,writable:!!w,enumerable:!!e});};
	var setPublicVar = function(n,v,w){setPrivateVar.call(this,n,v,w,true);};
	AudioSynthInstrument = function AudioSynthInstrument(){this.__init__.apply(this,arguments);};
	var setPriv = setPrivateVar.bind(AudioSynthInstrument.prototype);
	var setPub = setPublicVar.bind(AudioSynthInstrument.prototype);
	setPriv('__init__', function(a,b,c) {
		if(!_encapsulated) { throw new Error('AudioSynthInstrument can only be instantiated from the createInstrument method of the AudioSynth object.'); }
		setPrivateVar.call(this, '_parent', a);
		setPublicVar.call(this, 'name', b);
		setPrivateVar.call(this, '_soundID', c);
	});
	setPub('play', function(note, octave, duration) {
		return this._parent.play(this._soundID, note, octave, duration);
	});
	setPub('generate', function(note, octave, duration) {
		return this._parent.generate(this._soundID, note, octave, duration);
	});
	AudioSynth = function AudioSynth(){if(AudioSynthInstance instanceof AudioSynth){return AudioSynthInstance;}else{ this.__init__(); return this; }};
	setPriv = setPrivateVar.bind(AudioSynth.prototype);
	setPub = setPublicVar.bind(AudioSynth.prototype);
	setPriv('_debug',false,true);
	setPriv('_bitsPerSample',16);
	setPriv('_channels',1);
	setPriv('_sampleRate',44100,true);
	setPub('setSampleRate', function(v) {
		this._sampleRate = Math.max(Math.min(v|0,44100), 4000);
		this._clearCache();
		return this._sampleRate;
	});
	setPub('getSampleRate', function() { return this._sampleRate; });
	setPriv('_volume',32768,true);
	setPub('setVolume', function(v) {
		v = parseFloat(v); if(isNaN(v)) { v = 0; }
		v = Math.round(v*32768);
		this._volume = Math.max(Math.min(v|0,32768), 0);
		this._clearCache();
		return this._volume;
	});
	setPub('getVolume', function() { return Math.round(this._volume/32768*10000)/10000; });
	setPriv('_notes',{'C':261.63,'C#':277.18,'D':293.66,'D#':311.13,'E':329.63,'F':349.23,'F#':369.99,'G':392.00,'G#':415.30,'A':440.00,'A#':466.16,'B':493.88});
	setPriv('_fileCache',[],true);
	setPriv('_temp',{},true);
	setPriv('_sounds',[],true);
	setPriv('_mod',[function(i,s,f,x){return Math.sin((2 * Math.PI)*(i/s)*f+x);}]);
	setPriv('_resizeCache', function() {
		var f = this._fileCache;
		var l = this._sounds.length;
		while(f.length<l) {
			var octaveList = [];
			for(var i = 0; i < 8; i++) {
				var noteList = {};
				for(var k in this._notes) {
					noteList[k] = {};
				}
				octaveList.push(noteList);
			}
			f.push(octaveList);
		}
	});
	setPriv('_clearCache', function() {
		this._fileCache = [];
		this._resizeCache();
	});
	setPub('generate', function(sound, note, octave, duration) {
		var thisSound = this._sounds[sound];
		if(!thisSound) {
			for(var i=0;i<this._sounds.length;i++) {
				if(this._sounds[i].name==sound) {
					thisSound = this._sounds[i];
					sound = i;
					break;
				}
			}
		}
		if(!thisSound) { throw new Error('Invalid sound or sound ID: ' + sound); }
		var t = (new Date).valueOf();
		this._temp = {};
		octave |= 0;
		octave = Math.min(8, Math.max(1, octave));
		var time = !duration?2:parseFloat(duration);
		if(typeof(this._notes[note])=='undefined') { throw new Error(note + ' is not a valid note.'); }
		if(typeof(this._fileCache[sound][octave-1][note][time])!='undefined') {
			if(this._debug) { console.log((new Date).valueOf() - t, 'ms to retrieve (cached)'); }
			return this._fileCache[sound][octave-1][note][time];
		} else {
			var frequency=this._notes[note]*Math.pow(2,octave-4);
			var data=[];
			var sampleRate=this._sampleRate;
			var volume=this._volume;
			var channels=this._channels;
			var bitsPerSample=this._bitsPerSample;
			var attack=thisSound.attack(sampleRate,frequency,volume);
			var dampen=thisSound.dampen(sampleRate,frequency,volume);
			var wave=thisSound.wave.bind({modulate: this._mod, vars: this._temp});
			var val=0;
			var curVol=0;

			for (var i=0;i<(sampleRate*time);i++){
				if(i<=sampleRate*attack){
					curVol=volume*(i/(sampleRate*attack));
				} else {
					curVol=volume*Math.pow((1-((i-(sampleRate*attack))/(sampleRate*(time-attack)))),dampen);
				}

				val=curVol*Math.min(Math.max(wave(i,sampleRate,frequency,volume),-1),1);
				val=String.fromCharCode(val&255, (val>>>8)&255);
				data.push(val);
			}

			data = data.join('');

			// Format sub-chunk
			var chunk1 = [
				'fmt ', // Sub-chunk identifier
				pack(1, 16), // Chunk length
				pack(0, 1), // Audio format (1 is linear quantization)
				pack(0, channels),
				pack(1, sampleRate),
				pack(1, sampleRate * channels * bitsPerSample / 8), // Byte rate
				pack(0, channels * bitsPerSample / 8),
				pack(0, bitsPerSample)
			].join('');
			// Data sub-chunk (contains the sound)
			var chunk2 = [
				'data', // Sub-chunk identifier
				pack(1, data.length * channels * bitsPerSample / 8), // Chunk length
				data
			].join('');
			// Header
			var header = [
				'RIFF',
				pack(1, 4 + (8 + chunk1.length) + (8 + chunk2.length)), // Length
				'WAVE'
			].join('');
			var out = [header, chunk1, chunk2].join('');
			var dataURI = 'data:audio/wav;base64,' + escape(window.btoa(out));
			this._fileCache[sound][octave-1][note][time] = dataURI;
			if(this._debug) { console.log((new Date).valueOf() - t, 'ms to generate'); }
			return dataURI;
		}
	});
	setPub('play', function(note, octave, duration) {
		var src = this.generate(note, octave, duration);
		var audio = new Audio(src);
		audio.addEventListener('ended', function() { audio = null; });
		audio.autoplay = true;
		audio.setAttribute('type', 'audio/wav');
		return true;
	});
	setPub('debug', function() { this._debug = true; });
	setPub('createInstrument', function(sound) {
		var n = 0;
		var found = false;
		if(typeof(sound)=='string'){
			for(var i=0;i<this._sounds.length;i++){
				if(this._sounds[i].name==sound){found=true;n=i;break;}
			}
		} else {
			if(this._sounds[sound]){n=sound;sound=this._sounds[n].name;found=true;}
		}
		if(!found) { throw new Error('Invalid sound or sound ID: ' + sound); }
		_encapsulated=true;
		var ins=new AudioSynthInstrument(this,sound,n);
		_encapsulated = false;
		return ins;
	});
	setPub('listSounds', function(){
		var r = [];
		for(var i=0;i<this._sounds.length;i++){r.push(this._sounds[i].name);}
		return r;
	});
	setPriv('__init__', function(){
		this._resizeCache();
	});
	setPub('loadSoundProfile',function(){
		for(var i=0,len=arguments.length;i<len;i++){
			o=arguments[i];
			if(!(o instanceof Object)){throw new Error('Invalid sound profile.');}
			this._sounds.push(o);
		}
		this._resizeCache();
		return true;
	});
	setPub('loadModulationFunction',function(){
		for(var i=0,len=arguments.length;i<len;i++){
			f=arguments[i];
			if(typeof(f)!='function'){throw new Error('Invalid modulation function.');}
			this._mod.push(f);
		}
		return true;
	});
	AudioSynthInstance=new AudioSynth();
	Synth=AudioSynthInstance;
}();

Synth.loadModulationFunction(
	function(i,sampleRate,frequency,x){return   1 * Math.sin(2 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return   1 * Math.sin(4 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return   1 * Math.sin(8 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return   1 * Math.sin(0.5 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return   1 * Math.sin(0.25 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return 0.5 * Math.sin(2 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return 0.5 * Math.sin(4 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return 0.5 * Math.sin(8 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return 0.5 * Math.sin(0.5 * Math.PI * ((i / sampleRate) * frequency) + x); },
	function(i,sampleRate,frequency,x){return 0.5 * Math.sin(0.25 * Math.PI * ((i / sampleRate) * frequency) + x); }
);

Synth.loadSoundProfile({
	name: 'piano',
	attack: function(){return 0.002;},
	dampen: function(sampleRate,frequency,volume){
		return Math.pow(0.5*Math.log((frequency*volume)/sampleRate),2);
	},
	wave: function(i,sampleRate,frequency,volume){
		var base=this.modulate[0];
		return this.modulate[1](
			i,
			sampleRate,
			frequency,
			Math.pow(base(i,sampleRate,frequency,0),2)+(0.75*base(i,sampleRate,frequency,0.25))+(0.1*base(i,sampleRate,frequency,0.5)));
	}
},
{
	name: 'organ',
	attack: function(){return 0.3;},
	dampen: function(sampleRate,frequency){return 1+(frequency*0.01);},
	wave: function(i,sampleRate,frequency){
		var base=this.modulate[0];
		return this.modulate[1](
			i,
			sampleRate,
			frequency,
			base(i,sampleRate,frequency,0)+0.5*base(i,sampleRate,frequency,0.25)+0.25*base(i,sampleRate,frequency,0.5));
	}
},
{
	name: 'acoustic',
	attack:	function(){return 0.002;},
	dampen: function(){return 1;},
	wave: function(i,sampleRate,frequency){
		var vars=this.vars;
		vars.valueTable=!vars.valueTable?[]:vars.valueTable;
		if(typeof(vars.playVal)=='undefined'){vars.playVal=0;}
		if(typeof(vars.periodCount)=='undefined'){vars.periodCount=0;}
		var valueTable=vars.valueTable;
		var playVal=vars.playVal;
		var periodCount=vars.periodCount;
		var period=sampleRate/frequency;
		var p_hundredth=Math.floor((period-Math.floor(period))*100);
		var resetPlay=false;
		if(valueTable.length<=Math.ceil(period)){
			valueTable.push(Math.round(Math.random())*2-1);
			return valueTable[valueTable.length-1];
		} else {
			valueTable[playVal]=(valueTable[playVal>=(valueTable.length-1)?0:playVal+1]+valueTable[playVal])*0.5;
			if(playVal>=Math.floor(period)){
				if(playVal<Math.ceil(period)){
					if((periodCount%100)>=p_hundredth){
						// Reset
						resetPlay=true;
						valueTable[playVal+1]=(valueTable[0]+valueTable[playVal+1])*0.5;
						vars.periodCount++;
					}
				} else {
					resetPlay = true;
				}
			}
			var _return = valueTable[playVal];
			if(resetPlay){vars.playVal=0;} else {vars.playVal++;}
			return _return;
		}
	}
});

	var __audioSynth=new AudioSynth();

function AudioSynthView() {
	var isMobile=!!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);
	if(isMobile){var evtListener=['touchstart','touchend'];} else {var evtListener=['mousedown','mouseup'];}

//	var __audioSynth=new AudioSynth();
	__audioSynth.setVolume(0.5);
	var __octave=4;
	
	// Change octave
	var fnChangeOctave=function(x){
		x |= 0;
		__octave += x;
		__octave = Math.min(5, Math.max(3, __octave));
		var octaveName=document.getElementsByName('OCTAVE_LABEL');
		var i=octaveName.length;
		while(i--){
			var val=parseInt(octaveName[i].getAttribute('value'));
			octaveName[i].innerHTML=(val + __octave);
		}
		document.getElementById('OCTAVE_LOWER').innerHTML = __octave-1;
		document.getElementById('OCTAVE_UPPER').innerHTML = __octave+1;
	};

	// Key bindings, notes to keyCodes.
	var keyboard={
			50:'C#,-1',51:'D#,-1',53:'F#,-1',54:'G#,-1',
			55:'A#,-1',57:'C#,0', 48:'D#,0',187:'F#,0',
			61:'F#,0', 81:'C,-1', 87:'D,-1', 69:'E,-1',
			82:'F,-1', 84:'G,-1', 89:'A,-1', 85:'B,-1',
			73:'C,0',  79:'D,0',  80:'E,0', 219:'F,0',
			221:'G,0', 65:'G#,0', 83:'A#,0', 70:'C#,1',
			71:'D#,1', 74:'F#,1', 75:'G#,1', 76:'A#,1',
			90:'A,0',  88:'B,0',  67:'C,1',  86:'D,1',
			66:'E,1',  78:'F,1',  77:'G,1', 188:'A,1',190:'B,1'
		};
	var reverseLookupText={};
	var reverseLookup={};

	// Create a reverse lookup table.
	for(var i in keyboard){
		var val;
		switch(i|0) {
			case 187:val=61;break;
			case 219:val=91;break;
			case 221:val=93;break;
			case 188:val=44;break;
			case 190:val=46;break;
			default:val=i;break;
		}
		reverseLookupText[keyboard[i]]=val;
		reverseLookup[keyboard[i]]=i;
	}

	// Keys you have pressed down.
	var keysPressed=[];
	var visualKeyboard=null;
	var selectSound=null;

	var fnCreateKeyboard=function(keyboardElement){
		// Generate keyboard
		// This is our main keyboard element! It's populated dynamically based on what you've set above.
		visualKeyboard=document.getElementById('keyboard');
		selectSound=document.getElementById('sound');

		var iKeys=0;
		var iWhite=0;
		var notes=__audioSynth._notes;

		for(var i=-1;i<=1;i++){
			for(var n in notes){
				if(n[2]!='b'){
					var thisKey=document.createElement('div');
					if(n.length>1){
						thisKey.className='black key';
						thisKey.style.width='30px';
						thisKey.style.height='120px';
						thisKey.style.left=(40*(iWhite-1))+25+'px';
					} else {
						thisKey.className='white key';
						thisKey.style.width='40px';
						thisKey.style.height='200px';
						thisKey.style.left=40*iWhite+'px';
						iWhite++;
					}
					var label=document.createElement('div');
					label.className='label';
					label.innerHTML='<b>'+String.fromCharCode(reverseLookupText[n + ',' + i]) + '</b>' + '<br /><br />' + n.substr(0,1) +
						'<span name="OCTAVE_LABEL" value="' + i + '">' + (__octave + parseInt(i)) + '</span>' + (n.substr(1,1)?n.substr(1,1):'');
					thisKey.appendChild(label);
					thisKey.setAttribute('ID', 'KEY_' + n + ',' + i);
					thisKey.addEventListener(evtListener[0], (function(_temp) { return function() { fnPlayKeyboard({keyCode:_temp}); } })(reverseLookup[n + ',' + i]));
					visualKeyboard[n + ',' + i] = thisKey;
					visualKeyboard.appendChild(thisKey);
					iKeys++;
				}
			}
		}
		visualKeyboard.style.width=iWhite*40+'px';
		window.addEventListener(evtListener[1], function() { n = keysPressed.length; while(n--) { fnRemoveKeyBinding({keyCode:keysPressed[n]}); } });
	
	};

	// Creates our audio player
	fnPlayNote=function(note,octave){
		src=__audioSynth.generate(selectSound.value,note,octave,2);
		container=new Audio(src);
		container.addEventListener('ended',function(){container=null;});
		container.addEventListener('loadeddata',function(e){e.target.play();});
		container.autoplay=false;
		container.setAttribute('type','audio/wav');
		/*document.body.appendChild(container);*/
		container.load();
		return container;
	
	};

	// Detect keypresses, play notes.

	var fnPlayKeyboard = function(e){
		var i=keysPressed.length;
		while(i--){
			if(keysPressed[i]==e.keyCode){return false;}
		}
		keysPressed.push(e.keyCode);
	
		switch(e.keyCode){
			case 37:fnChangeOctave(-1);break;
			case 39:fnChangeOctave(1);break;
			case 16:
				break;
				fnPlaySong([
					['E,0',8],['D,0',8],['C,0',2],['C,0',8],
					['D,0',8],['C,0',8],['E,0',8],['D,0',1],
					['C,0',8],['D,0',8],['E,0',2],['A,0',8],
					['G,0',8],['E,0',8],['C,0',8],['D,0',1],
					['A,0',8],['B,0',8],['C,1',2],['B,0',8],
					['C,1',8],['D,1',8],['C,1',8],['A,0',1],
					['G,0',8],['A,0',8],['B,0',2],['C,1',8],
					['B,0',8],['A,0',8],['G,0',8],['A,0',1]
				]);
				break;
		}

		if(inibe==0){
			if(keyboard[e.keyCode]) {
				if(visualKeyboard[keyboard[e.keyCode]]) {
// cor de keypress red
					visualKeyboard[keyboard[e.keyCode]].style.backgroundColor = '#f00';
					visualKeyboard[keyboard[e.keyCode]].style.marginTop = '5px';
					visualKeyboard[keyboard[e.keyCode]].style.boxShadow = 'none';
				}
				var arrPlayNote = keyboard[e.keyCode].split(',');
				var note = arrPlayNote[0];
				var octaveModifier = arrPlayNote[1]|0;
				fnPlayNote(note, __octave + octaveModifier);
			} else {
				return false;	
			}
		}
	
	}



	// Remove key bindings once note is done.

	var fnRemoveKeyBinding = function(e) {
		var i = keysPressed.length;
		while(i--) {
			if(keysPressed[i]==e.keyCode) {
				if(visualKeyboard[keyboard[e.keyCode]]) {
					visualKeyboard[keyboard[e.keyCode]].style.backgroundColor = '';
					visualKeyboard[keyboard[e.keyCode]].style.marginTop = '';
					visualKeyboard[keyboard[e.keyCode]].style.boxShadow = '';
				}
				keysPressed.splice(i, 1);
			}
		}
	}

	// Set up global event listeners

	window.addEventListener('keydown', fnPlayKeyboard);
	window.addEventListener('keyup', fnRemoveKeyBinding);
	document.getElementById('-_OCTAVE').addEventListener('click', function() { fnChangeOctave(-1); });
	document.getElementById('+_OCTAVE').addEventListener('click', function() { fnChangeOctave(1); });
	
	Object.defineProperty(this, 'draw', {
		value: fnCreateKeyboard
	});

}

</script>

</head>

<body>

<center>
<span style="text-align:center;font-size:14pt;font-weight:bold;">
Piano criado por <a href="https://keithwhor.com/" target="_blank">Keith William Horwood</a>
... Som de 
<select id="sound">
<option value="0" selected="selected">Piano</option>
<option value="1">Órgão</option>
<option value="2">Violão</option>
</select>
</span>
</center>

<div class="keyboard-options">

<div ID="keyboard" class="keyboard-holder">
<div style="position:relative;left:-280px;top:230px;font-size:12pt;font-weight:bold;color:#c3c;">
Dó&nbsp;&nbsp;&nbsp;&nbsp;Ré&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mi&nbsp;&nbsp;&nbsp;&nbsp;Fá&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sol&nbsp;&nbsp;&nbsp;&nbsp;Lá&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Si
</div>
</div>


<div class="keyboard-options" style="text-align:center;font-size:11pt;font-weight:700;padding:10px;">
[C<span id="OCTAVE_LOWER">3</span>-B<span id="OCTAVE_UPPER">5</span>]
<button type="button" id="-_OCTAVE" style="font-family:Courier New;background-color:#fc0;font-weight:bold;">-</button>
<button type="button" id="+_OCTAVE" style="font-family:Courier New;background-color:#fc0;font-weight:bold;">+</button>
<i>(ou use as setas < e > para alterar as oitavas do teclado)</i>
<br>
Volume <input id="inpVol" onchange="vol(this.value);" type='range' min='0' max='1' step='0.1' value='.5' style="position:relative;top:8px;width:100px;filter: invert(50%) sepia(100%) saturate(9000%) hue-rotate(0deg);"></input>
Tempo <input id="inpTem" onchange="tem(this.value);" type='range' min='200' max='1000' step='50' value='500' style="position:relative;top:8px;width:100px;filter: invert(50%) sepia(50%) saturate(9000%) hue-rotate(190deg);"></input>
</div>

<table style="position:absolute;left:20px;top:20px;">
<tr><td colspan="2">Notas Musicais</td></tr>
<tr><td>A</td><td>Lá</td></tr>
<tr><td>B</td><td>Si</td></tr>
<tr><td>C</td><td>Dó</td></tr>
<tr><td>D</td><td>Ré</td></tr>
<tr><td>E</td><td>Mi</td></tr>
<tr><td>F</td><td>Fá</td></tr>
<tr><td>G</td><td>Sol</td></tr>
</table>



<script type="text/javascript">

var a = new AudioSynthView();
a.draw();



var nota=new Array;
var oita=new Array;
var musindex=0;
var str="";
//mus=mus+" ";
var m=0;
var myVar;
var parei=0;

function toca(){
//alert(parei);
	if(parei==0){
		m++;
//		if(mus.substring(m-1,m)!=" "){
		if(mus.substring(m-1,m).charCodeAt(0)>64 && mus.substring(m-1,m).charCodeAt(0)<72){
			if(mus.substring(m,m+1)=="#"){
				musindex++;
				nota[musindex]=mus.substring(m-1,m)+mus.substring(m,m+1);
				if(parei==0 && nota[musindex].length>0){
					//alert(nota[musindex].length);
					oita[musindex]=mus.substring(m+1,m+2);
					//alert(nota[musindex]+" "+oita[musindex]);
					//if(nota[musindex] && oita[musindex]){fnPlayNote(nota[musindex],oita[musindex]);}
					if(nota[musindex].charCodeAt(0)>64 && nota[musindex].charCodeAt(0)<72 && oita[musindex].charCodeAt(0)>49 && oita[musindex].charCodeAt(0)<54){fnPlayNote(nota[musindex],oita[musindex]);}
					m=m+2;
				} else {
					para();
				}
			} else {
				musindex++;
				nota[musindex]=mus.substring(m-1,m);
				if(parei==0 && nota[musindex].length>0){
					//alert(nota[musindex].length);
					oita[musindex]=mus.substring(m,m+1)
					//alert(nota[musindex]+" "+oita[musindex]);
					//if(nota[musindex] && oita[musindex]){fnPlayNote(nota[musindex],oita[musindex]);}
					if(nota[musindex].charCodeAt(0)>64 && nota[musindex].charCodeAt(0)<72 && oita[musindex].charCodeAt(0)>49 && oita[musindex].charCodeAt(0)<54){fnPlayNote(nota[musindex],oita[musindex]);}
					m=m+1;
				} else {
					para();
				}
			}
		}
	}
}



function para(){
	parei=1;
	//alert(parei);
	clearInterval(myVar);
}



function tocainterval(){
	parei=0;
	musindex=0;
	m=0;
	myVar=setInterval(toca,500);
}

var dur=500;

function tocaintervalinput(x){
	clearInterval(myVar);
	if(x==1){mus=document.getElementById("inpA").value.toUpperCase();}
	if(x==2){mus=document.getElementById("inpB").value.toUpperCase();}
	parei=0;
	musindex=0;
	m=0;
	myVar=setInterval(toca,dur);
}


/*
fnPlayNote("C#",4);
fnPlayNote("D",4);
fnPlayNote("E",4);
fnPlayNote("F",4);
*/

function jinibe(){inibe=1;}

function jpermite(){inibe=0;}

var teste="ABCDEFGHIJKLM";
var teste="0123456789";
//var n = str.charCodeAt(0);
for(w=0;w<12;w++){
//if(teste.charCodeAt(w)>64 && teste.charCodeAt(w)<72){alert(teste.charCodeAt(w) + " " + String.fromCharCode(teste.charCodeAt(w)));}
//if(teste.charCodeAt(w)>49 && teste.charCodeAt(w)<54){alert(teste.charCodeAt(w) + " " + String.fromCharCode(teste.charCodeAt(w)));}
}

</script>
<center>
<table style="position:relative;top:-10px;">
<tr><td class="tdnada">
<img src="p2.png" style="width:150px;"></img></td>
<td class="tdnada"><button type="button" onclick="tocaintervalinput(1);" style="background-color:#cfc;">Tocar 1</button>
<input id="inpA" type="text" value="" onfocus="jinibe()"; onblur="jpermite();" style="width:800px;border-width:3px;border-type:inset;"></input>
<br>
<br>
<button type="button" onclick="tocaintervalinput(2);" style="background-color:#ccf;">Tocar 2</button>
<input id="inpB" type="text" value="" onfocus="jinibe()"; onblur="jpermite();" style="width:800px;border-width:3px;border-type:inset;"></input>
<br><br>
<center><button type="button" onclick="para();"  style="background-color:#960;color:#fff;">Parar</button>
</center>
</td>
<td class="tdnada"><img src="p3.png" style="width:140px;"></img></td>
</tr></table>
</center>
<!--
<center>
<button onclick="f1(document.getElementById('inpA'))" style="position:relative;top:80px;">check position</button>
</center>
-->

<script>

document.getElementById("inpA").value="c3c3d3c3f3e3c3c3d3c3g3f3a3a3c4a3f3e3a#3a#3a3f3g3f3";
document.getElementById("inpB").value="c3c3d3c3f3e3 c3c3d3c3g3f3 a3a3c4a3f3e3  a#3a#3a3f3g3f3";
document.getElementById("inpVol").value=.5;
document.getElementById("inpTem").value=500;
function f1(el){
	var val=el.value;
	alert(val.slice(0,el.selectionStart).length);
}

function vol(v){
	__audioSynth.setVolume(v);
}

function tem(t){
	dur=t;
}


</script>
</body>
</html>
