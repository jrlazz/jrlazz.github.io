<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>shader_cg.html</title>

<link rel="icon" type="image/png" href="../img/github-mark.png">
<meta name="description" content="Shader cg">
<meta name="twitter:image" content="img/ag_baboy_right.png" />
<meta name="twitter:image:type" content="png" />
<meta name="twitter:image:width" content="19" />
<meta name="twitter:image:height" content="47" />

<style>
body{margin:0;overflow:hidden;background:#035;font-family:monospace;}
#info{position:absolute;top:10px;left:10px;
	color:#ff0;background-color:rgba(0,60,100,1);
	padding:10px;border:1px solid #ff0;
}
button{position:absolute;font-size:32pt;padding:8px;}
</style>

</head>

<body>

<button id="but" onclick="toggleFullScreen();" style="
position:absolute;left:90#;top:10px;width:80px;
font-size:41px;font-weight:bold;color:gold;
background-color:#060;border:3px outset #0c0;
box-shadow:3px 3px 6px #aaccaa;">T</button>

<button id="walk" style="left:10px;">WALK</B>
<button id="spir" style="left:160px;">SPIR</B>
<button id="orga" style="left:310px;">SPIR</B>
<button id="shok" style="left:460px;">SPIR</B>
<button id="start" style="left:610px;">START</B>

<script type="importmap">
{
	"imports": {
		"three": "https://unpkg.com/three@0.182.0/build/three.module.js",
		"three/addons/": "https://unpkg.com/three@0.182.0/examples/jsm/"
	}
}
</script>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";

document.getElementById("walk").onclick=()=>{uniforms.mode.value=0;}
document.getElementById("spir").onclick=()=>{uniforms.mode.value=1;}
document.getElementById("orga").onclick=()=>{uniforms.mode.value=2;}
document.getElementById("shok").onclick=()=>{uniforms.mode.value=3;}
document.getElementById("start").onclick=function(){uniforms.mode.value=5}
const clock=new THREE.Clock();

// SCENE
const scene=new THREE.Scene();

// CAMERA
const camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(-3,3,3);

// RENDERER
const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setClearColor('#035',1);
document.body.appendChild(renderer.domElement);

// CONTROLS
new OrbitControls(camera,renderer.domElement);

// LIGHT
scene.add(new THREE.AmbientLight(0xffffff,1.5));

// UNIFORMS
const uniforms={
	iTime:{value:0},
	mode:{value:5},
	layerSize:{value:18.0},
	speed:{value:6.0},
	glow:{value:0.0},
	brightness:{value:1.8}
};

// MATERIAL
const material=new THREE.ShaderMaterial({

uniforms:uniforms,

vertexShader:`
	varying vec3 vPos;
	void main(){
		vPos=position;
		gl_Position=
		projectionMatrix*
		modelViewMatrix*
		vec4(position,1.0);
	}
	`,

fragmentShader:`
	uniform float iTime;
	uniform int mode;
	uniform float layerSize;
	uniform float speed;
	uniform float glow;
	uniform float brightness;

	varying vec3 vPos;

	// wave functions
	float walking(){ return sin(vPos.y*layerSize+iTime*speed); }
	float spiral(){ float angle=atan(vPos.x,vPos.z); return sin(angle*10.0+vPos.y*8.0+iTime*speed); }
	float organic(){ return sin(vPos.y*layerSize+iTime*speed)+sin(vPos.x*8.0+iTime*speed*0.6)*0.3; }
	float shock(){ return sin(length(vPos.xy)*15.0-iTime*speed*1.2); }

	void main(){

	vec3 color=vec3(0.15);

	if(mode==5){
		// OLD GOOD MULTICOLOR
		const int bands=7;
		for(int i=0;i<bands;i++){
			float fi=float(i);
			float wave=sin(vPos.y*6.0+iTime*6.0+fi);
			float stripe=smoothstep(0.9,1.2,wave);
			vec3 bandColor=vec3(
				0.5+0.5*sin(iTime*0.7 + fi),
				0.5+0.5*sin(iTime*1.1 + 2.0 + fi),
				0.5+0.5*sin(iTime*1.3 + 4.0 + fi)
			);
			bandColor*=1.8;
        		color+=stripe*bandColor;
    		}
	}else{
    		// other modes
		float wave;
		if(mode==0) wave=walking();
			else if(mode==1) wave=spiral();
			else if(mode==2) wave=organic();
			else wave=shock();
			float stripe=smoothstep(0.85,1.02,wave);
			vec3 bandColor=vec3(
				0.5+0.5*sin(iTime*0.7),
				0.5+0.5*sin(iTime*1.1+2.0),
				0.5+0.5*sin(iTime*1.3+4.0)
			);
			bandColor*=brightness;
			color+=stripe*bandColor;
	}

	if(glow>0.5){
		float halo=smoothstep(0.7,1.0,sin(vPos.y*layerSize+iTime*speed));
		color+=halo*0.6*color;
	}

	gl_FragColor=vec4(color,1.0);
}
`
});

// GEOMETRIES
const mesh=new THREE.Mesh(new THREE.SphereGeometry(0.8,128,128),material);
mesh.rotation.x=Math.PI/2;
scene.add(mesh);

const box=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),material);
box.position.x=-2;
scene.add(box);

// ANIMATE
function animate(){
	requestAnimationFrame(animate);
	uniforms.iTime.value=clock.getElapsedTime();
	renderer.render(scene,camera);
}
animate();

// RESIZE
window.addEventListener("resize",()=>{
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
});

document.getElementById("but").style.left=window.innerWidth-90+"px";
</script>

<script>

function toggleFullScreen(){
    if(!document.fullscreenElement){
        document.documentElement.requestFullscreen();
    }else{
        document.exitFullscreen();
    }
}
</script>


</body>
</html>
