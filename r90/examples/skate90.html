<!DOCTYPE html>
<html lang="en">
<head>
<title>skate90.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="moonblue.ico" />
<style>
	@font-face {font-family:tipo;src:url('fonts/MysteryQuest-Regular.ttf');}
</style>

<script src="../build/three.min.js"></script>
<script src="js/loaders/DDSLoader.js"></script>
<script src="js/loaders/MTLLoader.js"></script>
<script src="js/loaders/OBJLoader.js"></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="js/loaders/STLLoader.js"></script>

</head>

<body style="overflow:hidden;margin:0px;background-color:#048;font-family:tipo;">

<audio id="som" controls style="position:absolute;top:50px;left:-100px;width:50px;display:;">
<source src="mp3/HDNight.mp3" type="audio/mpeg">
</audio>
<audio id="somH" controls style="position:absolute;top:100px;left:-100px;width:50px;display:;">
<source src="mp3/H.mp3" type="audio/mpeg">
</audio>


<img id="moonb" src="img/moonmoon.png" style="position:absolute;left:30px;top:80px;width:60px;opacity:0;"></img>

<span id="start" onclick="pronto();" style="position:absolute;left: 5%;top:100px;width:90%;text-align:center;color:#0ff;font-size:32pt;opacity:0;cursor:pointer;">
It is a hard day's night...<br>
after a lot of work ,<br>
with Anim8or, Blender and<br>
Three.js (of course),<br>
Joe created the Steve's skate!<br>
Click here <img  src="img/clicko.png" width="48" style="vertical-align:middle;"></img> to see the scene...
</span>

<a id="code" href="skate90.txt" target="_blank" style="position:absolute;left:5px;top:5px;color:#fff;text-decoration:none;font-size:24pt;display:none;">The Code</a>

<span id="talkS" style="position:absolute;left: 5%;top:50px;width:40%;text-align:center;color:#0ff;font-size:24pt;opacity:0.5;">Please wait for Steve...</span>
<span id="talkJ" style="position:absolute;left:55%;top:50px;width:40%;text-align:center;color:#ff0;font-size:24pt;opacity:0.5;">... and for Joe...</span>

<span id="posi" style="position:absolute;left: 5%;top:150px;color:#fff;font-size:24pt;"></span>

<img id="mus" src="img/music.png" style="position:absolute;left:-100;top:-100px;width:70px;"></img>

<script>

THREE.Cache.enabled=true;

var container,manager,objLoader,stlLoader,hex;

var camera,scene,renderer,controls;

var materialSTL,geometrySTL,pranchamat,prancha;

var TM1,TM2;

var altera=0;
var k=0;
var w=0;
var wS=0;
var cylinderG;
var rot=0;
var ang=0;
var opa=0;
var geometry,material,materials,fontLoader,textGeo,textGeo2,mo,cox;

var groupW=new THREE.Group();
var groupG=new THREE.Group();

var TX1=new THREE.Group();
var TX3=new THREE.Group();
var TX11=new THREE.Group();
var TX13=new THREE.Group();

var ES1=new THREE.Group();//ESFERA
var ES2=new THREE.Group();
var ES3=new THREE.Group();
var ES11=new THREE.Group();
var ES13=new THREE.Group();

var BB1=new THREE.Group();//BALL BEARING
var BB2=new THREE.Group();
var BB3=new THREE.Group();
var BB11=new THREE.Group();
var BB13=new THREE.Group();

var FRE=new THREE.Group();
var TRA=new THREE.Group();

var BDs,BDi,BEs,BEi,PDs,PDi,PEs,PEi,TR,TRC,CA;
var shoed,shoee,shoepos;

var groupCATR=new THREE.Group();
var groupTR=new THREE.Group();
var groupCI=new THREE.Group();
var groupPD=new THREE.Group();
var groupPE=new THREE.Group();
var groupBD=new THREE.Group();
var groupBE=new THREE.Group();
var group=new THREE.Group();

var passo=0.1;
var grido,planogeo,planomat,plano;

let text="\x61",bevelEnabled=true,font=undefined;
const height=10,size=50,hover=30,curveSegments=12,bevelThickness=2,bevelSize=1.5;

var dS=document.getElementById("talkS");
var dJ=document.getElementById("talkJ");
var dmus=document.getElementById("mus");

var lig=[];
var sphere=[];
var tS=[];
var tJ=[];

tS[ 0]="... Hi Joe! ...";				tJ[ 1]="... Hi Steve! ...";
tS[ 2]="... You know I like\nskateboarding ...";	tJ[ 3]="... I should have known better ...";
tS[ 4]="... I'm so tired now ...";			tJ[ 5]="... You can't do that ...";
tS[ 6]="... I lost my old brown shoes ...";		tJ[ 7]="... so You are a loser ...";
tS[ 8]="... yes, it is, is true ...";			tJ[ 9]="... let it be! ...";
tS[10]="... and if I fell in the ground? ...";		tJ[11]="... act naturally! ...";
tS[12]="... HELP! ...";					tJ[13]="... Do You need somebody\nor anybody? ...";
tS[14]="... I need You! ...";				tJ[15]="... tell me why ...";
tS[16]="... 'cause it is a long\nand winding road ...";	tJ[17]="... or a magical mystery tour? ...";
tS[18]="... I have to carry that weight ...";		tJ[19]="... and dig it ...";
tS[20]="... eight day's a week ...";			tJ[21]="... and following The Sun ...";
tS[22]="... it is my day in the life ...";		tJ[23]="... across the Universe ...";
tS[24]="... Good Night! ...";				tJ[25]="... Good Day Sunshine! ...";
tS[26]="... And Now ...";				tJ[27]="... And Then ...";


function init(){

	// RENDERER
	renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(window.innerWidth,window.innerHeight);
	renderer.setClearColor(0x004488,0);
	renderer.shadowMap.enabled=true;
	renderer.shadowMap.type=THREE.PCFSoftShadowMap;
	document.body.appendChild(renderer.domElement);

	// CAMERA
	camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1500);
	camera.position.set(0,0,120);

	// SCENE
	scene=new THREE.Scene();
	scene.translateY(-30);

	// LIGHTS
	lig[1]=new THREE.AmbientLight("#fff",1);
	scene.add(lig[1]);

	lig[2]=new THREE.PointLight('#fff',0.5);
	lig[2].position.set(30,60,40);
	scene.add(lig[2]);

	lig[3]=new THREE.PointLight('#fff',0.5);
	lig[3].position.set(-30,60,-40);
	lig[3].castShadow=true;
	scene.add(lig[3]);

	controls=new THREE.OrbitControls(camera,renderer.domElement);

	manager=new THREE.LoadingManager();
	manager.onLoad=function(){console.log('Loading complete!');};
	manager.onError=function(url){console.log('Error loading texture:'+url);};

	var onProgress=function(xhr){
		if(xhr.lengthComputable){
			var percentComplete=xhr.loaded/xhr.total*100;
			console.log(Math.round(percentComplete,2)+'% downloaded');
		}
	};

	var onError=function(xhr){};

	geometry=new THREE.SphereGeometry(3.1,16,16);
	material=new THREE.MeshStandardMaterial({color:'#ff0',metalness:0.9,roughness:0.2});

	sphere[0]=new THREE.Mesh(geometry,material);
	sphere[0].position.set(8,0,0);
	sphere[0].scale.set(1,1,1);

	sphere[1]=sphere[0].clone();sphere[1].position.set(4,6.5,0);
	sphere[2]=sphere[0].clone();sphere[2].position.set(4,-6.5,0);
	sphere[3]=sphere[0].clone();sphere[3].position.set(-4,6.5,0);
	sphere[4]=sphere[0].clone();sphere[4].position.set(-4,-6.5,0);
	sphere[5]=sphere[0].clone();sphere[5].position.set(-8,0,0);

	for(let z=0;z<6;z++){ES1.add(sphere[z]);}

	ES1.scale.set(0.5,0.5,0.5);
	ES1.rotation.set(0,-1.57,0);

	//materials=[new THREE.MeshStandardMaterial({color:'#222',metalness:0.9,roughness:0.2}),new THREE.MeshStandardMaterial({color:'#fff',metalness:0.9,roughness:0.2})];
	materials=[new THREE.MeshStandardMaterial({color:'#ff0',metalness:0.7,roughness:0.2}),new THREE.MeshStandardMaterial({color:'#ff0',metalness:0.9,roughness:0.2})];
	fontLoader=new THREE.FontLoader();
	fontLoader.load('fonts/GGK3404.json',function(response){
	font=response;
	createText();
	});

	function createText(){
		textGeo=new THREE.TextGeometry(text,{font:font,size:size,height:height,
		curveSegments:curveSegments,bevelThickness:bevelThickness,
		bevelSize:bevelSize,
		bevelEnabled:bevelEnabled});
        	textGeo.center();
		TM1=new THREE.Mesh(textGeo,materials);
		TM1.position.set(0,0,0);
		TM1.rotation.set(0,1.57,0);
		TM1.scale.set(0.25,0.25,0.25);

		textGeo2=new THREE.TextGeometry(text,{font:font,size:size,height:20,
		curveSegments:curveSegments,bevelThickness:bevelThickness,
		bevelSize:4,
		bevelEnabled:bevelEnabled});
		textGeo2.center();
		TM2=new THREE.Mesh(textGeo2,materials);
		TM2.position.set(0,0,0);
		TM2.rotation.set(0,1.57,0);
		TM2.scale.set(0.1,0.1,0.1);
	}


	var mtlLoader=new THREE.MTLLoader();
	var objLoader=new THREE.OBJLoader();
	var k=0;
	var setpat='models/steve/';

	mtlLoader.setPath(setpat);mtlLoader.load('partesfoscas.mtl',function(materials){materials.preload();objLoader.setMaterials(materials);objLoader.setPath(setpat);objLoader.load('steve_ca.obj',function(object){for(let k=0;k<30;k++){if(object.children[k]){object.children[k].castShadow=true;}}CA=object;},onProgress,onError);});
	mtlLoader.setPath(setpat);mtlLoader.load('partesfoscas.mtl',function(materials){materials.preload();objLoader.setMaterials(materials);objLoader.setPath(setpat);objLoader.load('steve_to.obj',function(object){for(let k=0;k<30;k++){if(object.children[k]){object.children[k].castShadow=true;}}TR=object;},onProgress,onError);});
	mtlLoader.setPath(setpat);mtlLoader.load('partesfoscas.mtl',function(materials){materials.preload();objLoader.setMaterials(materials);objLoader.setPath(setpat);objLoader.load('vivicox.obj' ,function(object){for(let k=0;k<30;k++){if(object.children[k]){object.children[k].castShadow=true;}}BDs=object;},onProgress,onError);});


	grido=new THREE.GridHelper(5000,100,'#644','#644');
	grido.position.set(0,0,0);

	planogeo=new THREE.PlaneGeometry(5000,5000);
	planomat=new THREE.MeshStandardMaterial({color:'#322',side:THREE.DoubleSide});
	plano=new THREE.Mesh(planogeo,planomat);
	plano.rotation.x=1.57;
	plano.position.set(0,-0.05,0);
	plano.receiveShadow=true;

	//STL
	stlLoader=new THREE.STLLoader(manager);

	stlLoader.load('models/steve/pranchaz.stl',function(geometrySTL){
		pranchamat=new THREE.MeshStandardMaterial({color:'#c90',metalness:0.5,roughness:0.2});
		prancha=new THREE.Mesh(geometrySTL,pranchamat);
		prancha.rotation.set(-1.57,0,1.57);
		prancha.position.set(0,7.7,0);
		prancha.scale.multiplyScalar(5);
		prancha.castShadow=true;
	});


	var geoshoe=new THREE.BoxGeometry(1.2,0.5,1.5);
	geoshoe.translate(0,0,0.2);
	var matshoe=new THREE.MeshStandardMaterial({color:'#432'});
	shoed=new THREE.Mesh(geoshoe,matshoe);
	shoed.position.y=-2.8;
	shoee=shoed.clone();
	shoepos=shoed.clone();

	render();
}

function animate(){
	requestAnimationFrame(animate);
	if(opa<1){
		opa +=0.005;
		document.getElementById("start").style.opacity=opa;
		document.getElementById("moonb").style.opacity=opa;
		dmus.style.left=window.innerWidth-100+"px";dmus.style.top=window.innerHeight-100+"px";
	}
	render();
}

function render(){
	if(altera==0){alterando();}
	if(document.getElementById("start").innerText=="OK"){
		scene.add(group);
		scene.add(grido);
		scene.add(plano);
		scene.add(TRA);
		scene.add(FRE);
		scene.add(prancha);
		document.getElementById("code").style.display="";
		document.getElementById("talkS").style.opacity=1;
		document.getElementById("talkJ").style.opacity=1;
	}

	if(altera==1 && document.getElementById("start").innerText=="OK"){

	document.getElementById("start").style.opacity="0";

		ES1.rotation.z -=(passo);
		ES3.rotation.z -=(passo);
		ES11.rotation.z -=(passo);
		ES13.rotation.z -=(passo);

		scene.rotation.y -=0.003;

		grido.position.z -=1;

		if(grido.position.z<=-1000){grido.position.z=0;}
		grido.position.z -=1;

		if(ang> 1.07){rot=1;}
		if(ang<-1.07){rot=0;}


if(wS>0 && wS<600){
		//document.getElementById("posi").innerText="move";
		if(rot==0){
			ang +=0.1;
			group.rotation.z +=0.01;
			groupPD.rotation.x +=0.1;
				groupBD.rotation.x -=0.1;
			groupBE.rotation.x +=0.1;
				CA.rotation.y -=0.025;
				TR.rotation.x +=0.01;
					BDi.rotation.x -=0.025;
					BEi.rotation.x +=0.025;
		}else{
			ang -=0.1;
			group.rotation.z -=0.01;
			groupPD.rotation.x -=0.1;
				groupBD.rotation.x +=0.1;
			groupBE.rotation.x -=0.1;
				CA.rotation.y +=0.025;
				TR.rotation.x -=0.01;
					BDi.rotation.x +=0.025;
					BEi.rotation.x -=0.025;
		}
}

if(wS==600){
	//document.getElementById("posi").innerText="tired";
	defpos();
	groupBD.rotation.set(0,0,0);groupBD.rotation.x=3.14;
	groupBE.rotation.set(0,0,0);
	PEi.rotation.x=0;
	groupPD.rotation.set(0,0,0);
	group.rotation.z=1.57;
	group.position.set(7,12,0);
}


if(wS==900){
	//document.getElementById("posi").innerText="deitando";
}
if(wS>900 && wS<1250){
		if(rot==0){
			ang +=0.1;
			shoed.position.z +=0.2;
			shoee.position.z +=0.2;
			shoed.position.y +=0.2;
			shoee.position.y -=0.2;
			shoed.position.x +=0.2;
			shoee.position.x +=0.2;
		}else{
			ang -=0.1;
			shoed.position.z +=0.2;
			shoee.position.z +=0.2;
			shoed.position.y +=0.2;
			shoee.position.y -=0.2;
			shoed.position.x +=0.2;
			shoee.position.x +=0.3;
		}
}


if(wS==1300){
		//document.getElementById("posi").innerText="deitado";
		defpos();
		group.rotation.set(1.50,0,0);
		groupBD.rotation.set(0,0,-1.57);
		groupBE.rotation.set(0,0,1.57);

		groupBD.position.set(-2.15,3.65,0);
		groupBE.position.set(2.15,3.65,0);

		PEi.rotation.x=0;
		group.position.set(0,10,0);
		groupPD.rotation.set(0,0,0);
		shoed.position.set(0,1000,0);
		shoee.position.set(0,1000,0);


}

if(wS==1500){
		//document.getElementById("posi").innerText="head down";
		defpos();
		group.rotation.y=0;
		groupBD.rotation.set(0,0,-1.57);
		groupBE.rotation.set(0,0,1.57);

		groupBD.position.set(-2.15,3.65,0);
		groupBE.position.set(2.15,3.65,0);

		PEi.rotation.x=0;
		group.rotation.set(3.14,0,0);
		group.position.set(0,37.5,0);
		groupPD.rotation.set(0,0,0);
		//shoed.position.copy(shoepos.position);
		//shoee.position.copy(shoepos.position);
}

if(wS>1500 && wS<1800){
	group.rotation.y -=0.3;
}

if(wS==1800){
		//document.getElementById("posi").innerText="help";
		tocaH();
		defpos();
		groupBD.position.set(-2.15,3.65,0);
		groupBE.position.set(2.15,3.65,0);
		groupBD.rotation.set(0,0,-1.57);
		groupBE.rotation.set(0,0,1.57);
		PEi.rotation.x=0;
		group.rotation.set(0,0,0);
		group.position.set(0,13,0);
		groupPD.rotation.set(0,0,0);
}

if(wS==2100){
		//document.getElementById("posi").innerText="perninha";
		defpos();
		groupBD.rotation.set(0,0,-1.57);
		groupBE.rotation.set(0,0,1.57);
		PEi.rotation.x=1.57;
		group.rotation.set(0,0,0);
		group.position.set(0,13,0);
		groupPD.rotation.set(0,0,0);
}


if(wS==2400){
		//document.getElementById("posi").innerText="maluco2";
		PEi.rotation.x=0;
		groupBD.position.set(-2.15,-2.3,0);
		groupBE.position.set(2.15,-2.3,0);
		TR.add(groupBD);
		TR.add(groupBE);
}
if(wS>2400 && wS<2600){
		if(rot==0){
			ang +=0.1;
			PEi.rotation.x -=0.1;
			CA.rotation.y +=0.1;
			TR.rotation.y +=0.1;
		}else{
			ang -=0.1;
			PEi.rotation.x +=0.1;
			CA.rotation.y -=0.1;
			TR.rotation.y -=0.1;
		}
}


if(wS==2600){
		//document.getElementById("posi").innerText="maluco2";
		PDi.rotation.x=0;
		PEi.rotation.x=0;
}
if(wS>2600 && wS<2800){
		PEi.rotation.x=0;
		if(rot==0){
			ang +=0.1;
			PDi.rotation.x +=0.1;
			CA.rotation.y +=0.1;
			TR.rotation.y +=0.1;
		}else{
			ang -=0.1;
			PDi.rotation.x -=0.1;
			CA.rotation.y -=0.1;
			TR.rotation.y -=0.1;
		}
}



if(wS>=2800){
		//document.getElementById("posi").innerText="maluco3";
		TR.rotation.set(0,0,0);
		PDi.rotation.x=0;
		PEi.rotation.x=0;
}



		wS++;
		for(let z=0;z<28;z++){
				if(tS[z] && wS>=z*150){dS.innerText=tS[z];dJ.innerText="...";}
				if(tJ[z] && wS>=z*150){dJ.innerText=tJ[z];}
		}

		if(wS==3000){
			groupBD.rotation.set(3.14,0,0);
			groupBD.position.set(0,0,0);
		}

		if(wS==4100){
			var somE=document.createElement("audio");
			somE.controls="true";
			somE.style.position="absolute";
			somE.style.top="150px";
			somE.style.left="-100px";
			somE.style.width="50px";
			document.body.appendChild(somE);
			somE.src="mp3/ANAT.mp3";
			somE.type="audio/mpeg";
			somE.play();
		}
/*
		if(wS==5100){
			var somW=document.createElement("audio");
			somW.controls="true";
			somW.style.position="absolute";
			somW.style.top="150px";
			somW.style.left="-100px";
			somW.style.width="50px";
			document.body.appendChild(somW);
			somW.src="mp3/ANAT.mp3";
			somW.type="audio/mpeg";
			somW.play();
		}
*/

		if(wS==4100){
		//	toca();
		}


		function defpos(){
			group.rotation.z=0;
			groupBD.rotation.set(0,0,0);
			groupPD.rotation.set(0,0,0);
			groupBE.rotation.set(0,0,0);
			groupPE.rotation.set(0,0,0);
			CA.rotation.y=0;
			TR.rotation.x=0;
			BDi.rotation.x=0;
			BEi.rotation.x=0;
		}


	}
	renderer.render(scene,camera);
}

function alterando(){

	window.setTimeout(segue,4000);

	function segue(){

		TX1.add(TM1);
		TX1.add(TM2);

		// rolamento direito

		BB1.add(ES1);
		BB1.add(TX1);
		BB1.position.set(8.2,-5,0);

		ES3=ES1.clone();
		ES11=ES1.clone();
		ES13=ES1.clone();

		TX3=TX1.clone();
		TX11=TX1.clone();
		TX13=TX1.clone();

		// rolamento esquerdo

		BB3.add(ES3);
		BB3.add(TX3);
		BB3.position.set(-8.2,-5,0);

		BB11.add(ES11);
		BB11.add(TX11);
		BB11.position.set(8.2,-5,0);

		BB13.add(ES13);
		BB13.add(TX13);
		BB13.position.set(-8.2,-5,0);

		TRA.add(BB1);
		TRA.add(BB3);
		TRA.scale.multiplyScalar(0.5);
		TRA.position.set(0,5.5,-9);

		FRE.add(BB11);
		FRE.add(BB13);
		FRE.scale.multiplyScalar(0.5);
		FRE.position.set(0,5.5,9);

		// Steve

		CA.position.set(0,2,0);
		TR.position.set(0,2,0);

		BDi=BDs.clone();
		BEs=BDs.clone();
		BEi=BDs.clone();
		PDs=BDs.clone();
		PDi=BDs.clone();PDi.add(shoed);
		PEs=BDs.clone();
		PEi=BDs.clone();PEi.add(shoee);

		BDs.position.set(-1.75,1,0);
		BDi.position.set(-1.75,-0.5,0);

		BEs.position.set(1.75,1,0);
		BEi.position.set(1.75,-0.5,0);

		PDs.position.set(0.025,0,0);
		PDi.position.set(0.05,-1.5,0);

		PEs.position.set(0.56,0,0);
		PEi.position.set(0.56,-1.5,0);
		PEi.rotation.x=1.75;

		BDs.scale.y=0.5;
		BEs.scale.y=0.5;

		BDi.scale.set(1,0.75,1);
		BEi.scale.set(1,0.75,1);

		PDs.scale.y=0.5;
		PEs.scale.y=0.5;
	
		groupCATR.add(CA);groupCATR.add(TR);
		groupPD.add(PDs);groupPD.add(PDi);
		groupPE.add(PEs);groupPE.add(PEi);
		groupBD.add(BDs);groupBD.add(BDi);
		groupBE.add(BEs);groupBE.add(BEi);

		group.add(groupCATR);
		group.add(groupPD);
		group.add(groupPE);
		group.add(groupBD);
		group.add(groupBE);

		group.scale.set(5,5,5);

		groupCATR.position.set(0,4,0);
		groupPD.position.set(-0.6,3,0);

		groupPD.rotation.set(0,0,-0.5);

		groupPE.position.set(0.0,3,0);
		groupBD.position.set(0.0,5,0);	groupBD.rotation.x=3.14;groupBD.position.set(0,6,0);
		groupBE.position.set(0.0,5,0);

		//group.rotation.y=1.27;
		group.scale.multiplyScalar(0.75);
		group.position.set(0,4,0);


		dS.innerText="";
		dJ.innerText="";

		altera++;
		animate();
	}
}

init();

function pronto(){
	document.getElementById("start").innerText="OK";
}

/*

Steve rides with his new skate

I've got nothing to say but it's OK...

The link:

http://jrlazz.eu5.org/r90/examples/skate90.html

Thanks to the Three.js Team 

*/

</script>

<script>

document.getElementById("som").volume=0.3; 

function pronto(){
	document.getElementById("start").innerText="OK";
	//som.pause();
	som.play();
	som.volume=0.3;
}

function toca(){
	som.play();
	som.volume=0.5;
}

function tocaH(){
	somH.play();
	somH.volume=1;
}

</script>


</body>
</html>
