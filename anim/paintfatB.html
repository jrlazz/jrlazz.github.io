<!DOCTYPE html>
<html lang="en">
<head>
<title>paintfatB.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>
span{position:absolute;font-family:Monospace;font-size:9pt;color:#008;z-index:2;}
body{margin:0px;background-color:#fff;overflow:hidden;}
</style>

<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.150.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.150.0/examples/jsm/"
    }
  }
</script>

</head>

<body>

<span id="spana" style="left:760px;top:10px;cursor:pointer;">right click &rarr; inspect &rarr; source code</span>
<span id="spand" style="left:10px;top:10px;"></span>

<script type="module">

import * as THREE from "three";
import { Line2 } from "three/addons/lines/Line2.js";
import { LineMaterial } from "three/addons/lines/LineMaterial.js";
import { LineGeometry } from "three/addons/lines/LineGeometry.js";

var container, renderer, scene, camera;
var color,sub;

var pp=[];for(let r=1;r<400;r++){pp[r]=[];}
var positions=[];for(let r=1;r<400;r++){positions[r]=[];}
var point=new THREE.Vector3();
var spline=[];
var divs,t;
var curvefactor=1;
var klineGeometry=[];
var kline=[];
var kmatLine=[];

var pointer=new THREE.Vector2();
var move=0;
var w=0;
var wcor;
var wwidth;

var wid=1024;
var hei=512;
// ******** init ********

function init(){
	renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setClearColor('#fff');
	renderer.setSize(wid,hei);
	document.body.appendChild(renderer.domElement);

	document.addEventListener('mousemove',onPointerMove);
	document.addEventListener('mousedown',onPointerDown);
	document.addEventListener('mouseup',onPointerUp);

	scene=new THREE.Scene();
	camera=new THREE.PerspectiveCamera(20,3,1,1000);
	camera.position.set(0,0,20);
}

function onPointerMove(event){
	if(move==1){calc();}
}

function onPointerDown(event){
	wcor=window.parent.ifra.cor;
	if(wcor=="R"){wcor=get_random_color();}
	wwidth=window.parent.ifra.size;
	calc();
	move=1;
	w++;
}

function calc(){
	pointer.x=(event.clientX/wid)*2-1;
	pointer.y=-(event.clientY/hei)*2+1;
	pointer.x=pointer.x*10.5;
	pointer.y=pointer.y*3.6;
}

function onPointerUp(event){move=0;}

function get_random_color(){
	color="";
	for(let i=0;i<3;i++){
        	sub=Math.floor(Math.random()*256).toString(16);
        	color +=(sub.length==1?"0"+sub:sub);
    	}
    	return "#"+color;
}

function animate(){
	requestAnimationFrame(animate);
	if(move==1){
		scene.remove(kline[w]);
		pp[w][0]=new THREE.Vector2(pointer.x,pointer.y);
		pp[w][1]=new THREE.Vector2(pointer.x,pointer.y);
		spline[w]=new THREE.SplineCurve(pp[w]);
		divs=curvefactor*(pp[w].length-1);
		point[w]=new THREE.Vector3();
		for(let i=0;i<divs;i++){
			t=i/divs;
			spline[w].getPoint(t,point[w]);
			positions[w].push(point[w].x,point[w].y,point[w].z);
		}
		kmatLine[w]=new LineMaterial({color:wcor,linewidth:wwidth});
		kmatLine[w].resolution.set(window.innerWidth,window.innerHeight);
		klineGeometry[w]=new LineGeometry();
		klineGeometry[w].setPositions(positions[w]);
		kline[w]=new Line2(klineGeometry[w],kmatLine[w]);
		scene.add(kline[w]);
	}

	//if(kline[2]){kline[2].rotation.y +=0.1;}

	renderer.render(scene,camera);
}

init();

animate();

/*

Painting with fat lines

Hi Three.js followers,

I would like Someone suggests a right way to convert mouse position !!!
This workaround (with iframe) is not a good project.
I would like to get correct mouse position calculation and have resize option !!!

the link:

http://jrlazz.eu5.org/anim/paintfatA.html

Again, Thanks for the great Three.js Team!

Jose Roberto Lazzareschi

*/

</script>

</body>

</html>
