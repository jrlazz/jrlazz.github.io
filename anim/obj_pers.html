<!DOCTYPE html>
<html lang="en">
<head>
<title>obj_pers.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>
body{margin:0px;border:0px;background-color:#002244;font-family:Monospace;overflow:hidden;}
span{position:absolute;color:#ff0;font-size:10pt;cursor:pointer;}
</style>

</head>

<body>

<span id="spanA" style="left:10px;top:5px;">right click &rarr; inspect &rarr; source code</span>

<script type="module">

import * as THREE from '../js/three.module_res_res.js';
import { OrbitControls } from '../js/OrbitControls_res_res.js';
import { DDSLoader } from '../js/DDSLoader_res_res.js';
import { MTLLoader } from '../js/MTLLoader_res_res.js';
import { OBJLoader } from '../js/OBJLoader_res_res.js';
import { FontLoader } from '../js/FontLoader_res_res.js';
import { TextGeometry } from '../js/TextGeometry_res_res.js'

var manager, stats, controls;
var camera, scene, renderer, loader, GGK, texGGK, matGGK, geoGGK;
var fix={};
var w=0;

function init() {
	camera = new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,0.1,1000);
	camera.position.set(0,50,100);
	scene=new THREE.Scene();

	renderer= new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor(0x002244,1);
	document.body.appendChild(renderer.domElement);
	renderer.shadowMap.enabled=true;

	controls=new OrbitControls(camera,renderer.domElement);

	manager=new THREE.LoadingManager();
	manager.onStart=function(url,itemsLoaded,itemsTotal){console.log('Started loading file:'+url+'.\nLoaded '+itemsLoaded+' of '+itemsTotal + ' files.' );};
	manager.onLoad=function(){console.log('Loading complete!');};
	manager.onProgress=function(url,itemsLoaded,itemsTotal){console.log('loading texture'+url+' '+(itemsLoaded/itemsTotal*100)+'%');};
	manager.onError=function(url){console.log('Error loading texture:'+url);};
	manager.addHandler(/\.dds$/i,new DDSLoader());

	new MTLLoader(manager).load('models/extras/obj_pers2.mtl',function(mat){mat.preload();new OBJLoader(manager).setMaterials(mat).load('models/extras/obj_pers2.obj',function(object){
	object.traverse(function(child){
    		if (child.isMesh){
        		child.castShadow=true;
			//child.receiveShadow=true;
		}
	})
	fix[2]=object;
	fix[2].scale.set(14,14,14);
	fix[2].position.set(0,13,0);
	scene.add(fix[2]);},manager.onProgress,manager.onError);});






	// Text
	let textMesh1, textMesh2, textGeo, materials;
	let text="Personagem",bevelEnabled=true,font=undefined;
	const height=4,size=50,hover=30,curveSegments=8,bevelThickness=2,bevelSize=2;

	loader=new FontLoader();
	loader.load('../js/roboto_italic.typeface.json',function(response){
	font=response;
	createText();
	});

function createText() {
	textGeo=new TextGeometry(text,{font:font,size:size,height:height,curveSegments:curveSegments,bevelThickness:bevelThickness,bevelSize:bevelSize,bevelEnabled:bevelEnabled});
        textGeo.center();
//	textGeo.computeBoundingBox();
//	const centerOffset=-0.5*(textGeo.boundingBox.max.x-textGeo.boundingBox.min.x);
	materials=[
		new THREE.MeshPhongMaterial({color:0x000088,flatShading:true}),// front
		new THREE.MeshPhongMaterial({color:0xffff00})// side
	];
	textMesh1=new THREE.Mesh(textGeo,materials);
//	textMesh1.rotation.set(-0.4,0,0);//Math.PI*2
	textMesh1.position.set(0,1,32);
	textMesh1.scale.set(0.05,0.05,0.05);
//	textMesh1.castShadow=true;
	scene.add(textMesh1);

}
















	texGGK=new THREE.TextureLoader(manager).load('models/extras/bojomad2.jpg');
	texGGK.wrapS=THREE.RepeatWrapping;texGGK.wrapT=THREE.RepeatWrapping;
	texGGK.repeat.set(1,2);
	matGGK=new THREE.MeshStandardMaterial({map:texGGK,color:('#fff'),transparent:true});
	geoGGK=new THREE.BoxGeometry(100,100,0.5);
	GGK=new THREE.Mesh(geoGGK,matGGK);
	GGK.rotation.set(1.57,0,1.57);
	GGK.position.set(0,-2.5,0);
	GGK.receiveShadow=true;
	scene.add(GGK);

	var starB=new THREE.PointLight("#fff",1.0);starB.castShadow=true;starB.shadow.mapSize.width=2048;starB.shadow.mapSize.height=2048;scene.add(starB);
	var ambient=new THREE.AmbientLight("#fc9",0.5);scene.add(ambient);
	starB.position.set( 120,200, 10);

	window.addEventListener('resize',onWindowResize);

}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );
}

function animate(){
	requestAnimationFrame(animate);
	render();
	controls.update();
}

function render(){
	if(fix[2]){fix[2].rotation.y -=0.05;}
	renderer.render(scene,camera);
}

init();
animate();

</script>
</body>
</html>
