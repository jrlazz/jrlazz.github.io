<!DOCTYPE html>
<html lang="en">
<head>
<title>fbx_anim_02.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>
body{margin:0px;border:0px;background-color:#002244;font-family:Monospace;overflow:hidden;}
span{position:absolute;color:#ff0;font-size:9pt;cursor:pointer;}
</style>

</head>

<body>

<span id="spanA" style="left:100px;top:5px;">right click &rarr; inspect &rarr; source code</span>

<script type="module">
import * as THREE from '../js/three.module_res_res.js';
import Stats from '../js/stats.module_res_res.js';
import { OrbitControls } from '../js/OrbitControls_res_res.js';
import { FBXLoader } from '../js/FBXLoader_res_res.js';

var camera, scene, renderer, loader, controls, mixer, stats, mesh, poly, ambLight, dirLight, tex;
var clock = new THREE.Clock();
var delta=0;
var w=0;

function init(){

	camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1000);
	camera.position.set(0,50,100);

	scene=new THREE.Scene();
	scene.background=new THREE.Color(0x112244);
	scene.position.set(0,-20,0);




	renderer=new THREE.WebGLRenderer({antialias:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(window.innerWidth,window.innerHeight);
	renderer.shadowMap.enabled=true;
	document.body.appendChild(renderer.domElement);

	controls=new OrbitControls(camera,renderer.domElement);
	//controls.update();

	window.addEventListener('resize',onWindowResize);

	// stats
	stats=new Stats();
	document.body.appendChild(stats.dom);

	var starB=new THREE.PointLight("#fcf",1.0);
	starB.position.set(-120,150,50);
	starB.castShadow=true;starB.shadow.mapSize.width=2048;starB.shadow.mapSize.height=2048;
	scene.add(starB);


/*
		const dirLight = new THREE.DirectionalLight( 0xffcc99,0.5 );
		dirLight.position.set( 0, 200, -100 );
		dirLight.castShadow = true;
		dirLight.shadow.camera.top = 180;
		dirLight.shadow.camera.bottom = - 100;
		dirLight.shadow.camera.left = - 120;
		dirLight.shadow.camera.right = 120;
		scene.add( dirLight );
*/
	ambLight=new THREE.AmbientLight(0xffcc99,0.5);
	scene.add(ambLight);


	// ground
	tex=new THREE.TextureLoader().load('models/extras/bojomad2.jpg');
	//tex.wrapS=THREE.RepeatWrapping;tex.wrapT=THREE.RepeatWrapping;
	//tex.repeat.set(1,2);
	mesh=new THREE.Mesh(new THREE.BoxGeometry(150,100,1),new THREE.MeshStandardMaterial({map:tex,color:0xcccccc,side:THREE.DoubleSide,depthWrite:true}));
	mesh.rotation.x=-Math.PI/2;
	mesh.position.set(0,0,-10);
	mesh.receiveShadow=true;
	scene.add(mesh);

	// isometric.blend
	loader=new FBXLoader();
	loader.load('models/extras/blember.fbx',function(object){
		mixer=new THREE.AnimationMixer(object);
		object.traverse(function(child){
			if(child.isMesh){
				child.castShadow=true;
				//child.receiveShadow=true;
		}
		});
		//const action=mixer.clipAction(object.animations[0]);
		//action.play();
		poly=object;
		poly.position.set(0,17.5,0);
		poly.rotation.set(0,2.3,0);
		poly.scale.set(0.1,0.1,0.1);
		scene.add(poly);
	});


}

function onWindowResize(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate(){
	requestAnimationFrame(animate);
	renderer.render(scene,camera);
	stats.update();
	if(poly){poly.rotation.y +=0.02;}
w++;
	if(poly && w>10){
		//delta=clock.getDelta();
		//delta +=0.02;if(delta>0.2){delta=0;}
		//if(mixer)mixer.update(delta*1);
	}
	if(w==20){

		scene.add(poly);
	}
	
}

init();

animate();

</script>

</body>
</html>
