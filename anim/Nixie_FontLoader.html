<!DOCTYPE html>
<html lang="en">
<head>
<title>Nixie_FontLoader.html</title>
<meta charset="utf-8">

<link rel="icon" type="image/png" href="img/github-mark.png">
<meta name="description" content="FontLoader jealous of Nixie, created a cheaper alternative...">
<meta name="twitter:image" content="img/ag_baboy_right.png" />
<meta name="twitter:image:type" content="png" />
<meta name="twitter:image:width" content="19" />
<meta name="twitter:image:height" content="47" />

<style>
@font-face{font-family:tipo;src:url('../fonte/MysteryQuest-Regular.ttf');}
body{overflow:hidden;margin:0px;}
button{position:absolute;font-family:tipo;font-size:16pt;font-family:tipo;border-radius:50%;color:#fc0;background-color:#090;border-color:#f90;cursor:pointer;}
</style>
</head>
<body style="overflow:hidden;margin:0px;background-color:#001128;">

<span style="position:absolute;left:10px;top:10px;color:#f90;font-family:tipo;cursor:pointer;"> right click &rarr; inspect &rarr; source code</span>

<script type="module">

import * as THREE from '../js/three.module_res_res.js';
import { FontLoader} from '../js/FontLoader_res_res.js';
import { TextGeometry } from '../js/TextGeometry_res_res.js';
import { OrbitControls } from '../js/OrbitControls_res_res.js';
import { STLLoader } from '../js/STLLoader_res_res.js';
import { DDSLoader } from '../js/DDSLoader_res_res.js';

var container,manager,objLoader,hex;
var camera, cameraTarget, scene, renderer, controls, stlLoader;
var ambientLight, frontLight, pointLight;

var matcup, cup;
var matA,matB;
var text=[];
var textG=[];
var texto="";
var altera=0;
var f=-60;
var w=0;
var x=0;
var y=0;
var z=0;
var j=0;
var ch=0;

var bevelEnabled=true,font=undefined;
var height=0.005,size=40,hover=30,cS=6,bT=0.3,bS=0.5;

	container=document.createElement('div');
	document.body.appendChild(container);

	camera = new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1000);
	camera.position.set(0,10,50 );
	cameraTarget = new THREE.Vector3(0,0,0);

	scene = new THREE.Scene();
	scene.position.set(0,5,-10 );

	renderer = new THREE.WebGLRenderer( { antialias: true } );
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor('#001128',1);


	container.appendChild( renderer.domElement );

	controls=new OrbitControls(camera,renderer.domElement);
	controls.minDistance=10;
	controls.maxDistance=600;
	controls.enablePan=true;
	controls.enableZoom=true;
	controls.enableRotate=true;
	controls.minPolarAngle=-Math.PI/5;
	controls.maxPolarAngle=Math.PI/3;
//	controls.minAzimuthAngle = 0; // radians
//	controls.maxAzimuthAngle = 0; // radians
	controls.enableDamping=true;

	manager=new THREE.LoadingManager();
	manager.onStart=function(url,itemsLoaded,itemsTotal){console.log('Started loading file:'+url+'.\nLoaded '+itemsLoaded+' of '+itemsTotal + ' files.' );};
	manager.onLoad=function(){console.log('Loading complete!');};
	manager.onProgress=function(url,itemsLoaded,itemsTotal){console.log('loading texture'+url+' '+(itemsLoaded/itemsTotal*100)+'%');};
	manager.onError=function(url){console.log('Error loading texture:'+url);};
	manager.addHandler(/\.dds$/i,new DDSLoader());

	ambientLight=new THREE.AmbientLight("#fc9",2);
	scene.add(ambientLight);

	frontLight=new THREE.DirectionalLight('#fc9',3);
	frontLight.position.set(0,-25,20).normalize();
	scene.add(frontLight);

	pointLight=new THREE.PointLight('#fc9',2);
	pointLight.position.set(0,50,50 );
	scene.add(pointLight);

	stlLoader=new STLLoader(manager);
	stlLoader.load('models/extras/nixie_tube_bl1.stl',function(geometrySTL){
		matcup=new THREE.MeshPhysicalMaterial({color:0xffffff,transparent:true,opacity:0.4,metalness:0.95,roughness:0.1,wireframe:false});
		cup=new THREE.Mesh(geometrySTL,matcup);
		cup.scale.set(0.15,0.15,0.15);
		cup.position.set(0,4,0);
		cup.rotation.set(-1.57,0,0);
	});

	matA=[new THREE.MeshStandardMaterial({color:'#ff0',flatShading:true,metalness:0.7,roughness:0.1}),new THREE.MeshStandardMaterial({color:'#630',flatShading:true,metalness:0.5,roughness:0.3})];
	matB=[new THREE.MeshStandardMaterial({color:'#000',transparent:true,opacity:0.0}),new THREE.MeshStandardMaterial({color:'#630',flatShading:true,metalness:0.7,roughness:0.1,transparent:true,opacity:0.9})];

	const loader=new FontLoader();
	loader.load('fonte/Bulgarian Courier_Thin_128.json',function(response){font=response;cText();});

function cText(){
	for(z=0;z<10;z++){
		textG[z]=new TextGeometry(String.fromCharCode(48+z),{font:font,size:size,height:height,curveSegments:cS,bevelThickness:bT,bevelSize:bS,bevelEnabled:bevelEnabled});
		text[z]=new THREE.Mesh(textG[z],matB);
		text[z].position.set(-4.2,-3,z/8);text[z].scale.set(0.25,0.25,0.25);
	}
}

function cTextS(texto,ch){
		for(z=0;z<10;z++){
			scene.remove(text[z]);
			text[z]=new THREE.Mesh(textG[z],matB);
			text[z].position.set(-4.2,-3,z/8);text[z].scale.set(0.25,0.25,0.25);
			scene.add(text[z])
		}
		text[ch]=new THREE.Mesh(textG[ch],matA);
		text[ch].position.set(-4.2,-3,ch/8);text[ch].scale.set(0.25,0.25,0.25);
		scene.add(text[ch]);
}

	var cyG=new THREE.CylinderGeometry(3.8,3.8,3,32);
	var cyMat=new THREE.MeshPhysicalMaterial({color:'#050505'});
	var cyM=new THREE.Mesh(cyG,cyMat);
	cyM.scale.set(1,1,1);
	cyM.rotation.set(-0.05,0,0);
	cyM.position.set(0,-9,0);


	var center = new THREE.Vector3();
	//mesh.geometry.computeBoundingBox();
	//mesh.geometry.boundingBox.getCenter(center);
	//mesh.geometry.center();
	//mesh.position.copy(center);

	var plT=new THREE.TextureLoader(manager).load('img/pcb.jpg');
	var plG=new THREE.BoxGeometry(50,1,50);
	var plMat=new THREE.MeshStandardMaterial({color:'#333',map:plT});
	var plM=new THREE.Mesh(plG,plMat);
	plM.geometry.computeBoundingBox();
	plM.geometry.boundingBox.getCenter(center);
	plM.geometry.center();
	plM.position.copy(center);
	plM.position.set(0,-2,0);

function animate() {
	requestAnimationFrame(animate);
	controls.update();
	render();
}
function render() {
	renderer.render(scene,camera);
	if(altera==0){alterando();}
	if(altera==1){
		f++;
		w=f/60;
		if(w==1 || w==2 || w==3 || w==4 || w==5 || w==6 || w==7 || w==8 || w==9 || w==10) {texto=String.fromCharCode(47+w);cTextS(texto,w-1);}
		if(w==11){f=0;}
	}
}

function alterando(){
	const myTimeout=setTimeout(segue,1000);
	function segue(){
		cyM.add(plM);
		scene.add(cyM);
		scene.add(cup);
		for(z=0;z<10;z++){scene.add(text[z]);}
	}
	altera++;
}

animate();

/*

Hi Three.js followers,

FontLoader jealous of Nixie, created a cheaper alternative...

the link:

http://jrlazz.eu5.org/anim/Nixie_FontLoader.html

Again, Thanks for the great Three.js Team!

Jose Roberto Lazzareschi


*/

</script>

</body>
</html>
