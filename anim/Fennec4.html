<!DOCTYPE html>
<html lang="en">
<head>
<title>Fennec4.html</title>
<meta charset="utf-8" />
<link rel="shortcut icon" href="../ok.ico">

<script type="importmap">
{"imports": {"three": "https://cdn.jsdelivr.net/npm/three@0.172.0/build/three.module.min.js",
"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.172.0/examples/jsm/"}}
</script>

<style>
body {margin: 0;background-color: FF796c;font-family: Monospace;font-size: 9pt;color: #cff;overflow: hidden;}
</style>

</head>

<body>

<span style="position:absolute;width:99%;top:10px;font-size:14pt;font-weight:bold;color:#009;text-align:center;">
Obs: Cylinder oscillates between the leters t and r ...
</span>

<script type="module">
import * as THREE from "three"
import { OrbitControls } from "three/addons/controls/OrbitControls.js"
import Stats from "three/addons/libs/stats.module.js"
import { Flow } from "three/addons/modifiers/CurveModifier.js"
import { FontLoader } from "three/addons/loaders/FontLoader.js"
import { TextGeometry } from "three/addons/geometries/TextGeometry.js"

const curveHandles = []
let stats
let scene, camera, renderer, control, flow, currentT = 0.25
var g=[],l=[],m=[],s=[]

class CurvePositionLabel extends THREE.Group {
	constructor(curve) {
		super()
		this.curve = curve
		this.positionAtT = new THREE.Vector3()
		const pointGeometry = new THREE.SphereGeometry(0.05,32,32)
		const pointMaterial = new THREE.MeshBasicMaterial({ color: "red" })
		const point = new THREE.Mesh(pointGeometry, pointMaterial)
		this.add(point)
	}
	setPositionAtT(t) {
		this.curve.getPoint(t, this.positionAtT)
		this.position.copy(this.positionAtT)
	}

}

	scene = new THREE.Scene()

	camera = new THREE.PerspectiveCamera(40,window.innerWidth / window.innerHeight, 1, 1000,)
	camera.position.set(2, 2, 3)

	const initialPoints = [
		{ x: 1, y: 0, z: -1 },
		{ x: 1, y: 0, z: 1 },
		{ x: -1, y: 0, z: 1 },
		{ x: -1, y: 0, z: -1 },
	]

	const boxGeometry = new THREE.BoxGeometry(0.05, 0.05, 0.05)
	const boxMaterial = new THREE.MeshBasicMaterial()
	for (const handlePos of initialPoints) {
		const handle = new THREE.Mesh(boxGeometry, boxMaterial)
		handle.position.copy(handlePos)
		curveHandles.push(handle)
		scene.add(handle)
	}

	const curve = new THREE.CatmullRomCurve3(curveHandles.map((handle) => handle.position),)
	curve.curveType = "centripetal"
	curve.closed = true

	const points = curve.getPoints(50)

	const line = new THREE.LineLoop(
		new THREE.BufferGeometry().setFromPoints(points),
		new THREE.LineBasicMaterial({color:'#0f0'}),
	)
	scene.add(line)

	const light = new THREE.DirectionalLight(0xffaa33, 50)
	light.position.set(-10, 10, 10)
	scene.add(light)

	const light2 = new THREE.AmbientLight(0xffffff, 2)
	scene.add(light2)

	// Curve tracker
	const trackerLabel = new CurvePositionLabel(curve)
	scene.add(trackerLabel)

function fonto(){
	const loader = new FontLoader()
	loader.load(
		"https://unpkg.com/three@0.170.0/examples/fonts/helvetiker_regular.typeface.json",
    		function (font) {
			const geometry = new TextGeometry("Hello three.js!", {
			font: font, size: 0.2, depth: 0.05, bevelEnabled: false})
			geometry.rotateX(Math.PI)
			const material = new THREE.MeshStandardMaterial({color:'#009'})
			const objectToCurve = new THREE.Mesh(geometry, material)
			flow = new Flow(objectToCurve)
			flow.updateCurve(0, curve)
			scene.add(flow.object3D)
		},
	)
}

fonto()

	g[2]=new THREE.CylinderGeometry(0.02,0.02,1)
	m[2]=new THREE.MeshStandardMaterial({color:'#0f0'})
	s[2]=new THREE.Mesh(g[2],m[2])
	scene.add(s[2])

	renderer = new THREE.WebGLRenderer({ antialias: true })
	renderer.setPixelRatio(window.devicePixelRatio)
	renderer.setClearColor("#FF796c")
	renderer.setSize(window.innerWidth, window.innerHeight)
	document.body.appendChild(renderer.domElement)
	const orbit = new OrbitControls(camera, renderer.domElement)
	stats = new Stats()
	document.body.appendChild(stats.dom)
	window.addEventListener("resize", onWindowResize)

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight
	camera.updateProjectionMatrix()
	renderer.setSize(window.innerWidth, window.innerHeight)
}

function animate() {
	requestAnimationFrame(animate)
	if (flow) {
		flow.moveAlongCurve(0.001)
		trackerLabel.setPositionAtT((currentT += 0.001))
		//console.log(trackerLabel.position)
		s[2].position.set(trackerLabel.position.x,trackerLabel.position.y,trackerLabel.position.z)
	}
	stats.update()
	renderer.render(scene, camera)
}

animate()

</script>
</body>
</html>