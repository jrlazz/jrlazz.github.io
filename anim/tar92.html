<!DOCTYPE html>
<html lang="en">
<head>
<title>tar90</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>

body{margin:0px;border:0px;font-family:Monospace;background-color:#069;overflow:hidden;}
span{font-size:40pt;font-family:Arial;color:#ff0;}
.draggable{width:50px; height:50px; position:absolute; transform:rotate(0deg) translateX(0px);}
img{position:absolute;top:12px;width:100px;cursor:pointer;z-index:2;}
a{text-decoration:none;font-size:32pt;color:#0f0;}
.classimg{width:100px;}

</style>

<script src="../js/three.min90.js"></script>

</head>

<body>

<span onclick="javascript:teclaC=1;" style="position:absolute;left:10px;top:20px;cursor:ponter;">B</span>
<span onclick="javascript:teclaB=1;"  style="position:absolute;left:10px;top:120px;cursor:ponter;">C</span>

<span id="spanaux" style="position:absolute;left:10px;top:200px;"></span>
<span id="spanaux2" style="position:absolute;left:10px;top:400px;color:#090;">XXX</span>

<div id="container"></div>

<script>

//import * as THREE from '../js/three.module90.js';

var container=document.getElementById('container');

var target=new THREE.Vector3();
var altera=0;
var completo=0;
var conta=0;
var mov=0.15;
var point;
var axes;
var circle;

const objects = [];

var k=0;

var rot=new Array();
rot[1]=0;

var w=0;
var ww=0;
var etapa=0;

var heli=[];
var nave=[];
var de2ra=function(degree){return degree*(Math.PI/180);};

var teclaA=0;var teclaD=0;
var teclaW=0;var teclaS=0;
var teclaG=0;var teclaH=0;
var teclaC=0;var teclaB=0;
var teclaV=0;
var setaE=0;var setaD=0;
var setaC=0;var setaB=0;




var mousedu=0;var movemouse=0;

var box=[];var geo=[];var mat=[];
var axes,cube;

var xx=0;var yy=0;var xxant=0;var yyant=0;
var p=Math.PI;
var w=60;
var dire=0;var zooo=0;var hori=0;var vert=0;var conta=0;
var gru,ball,ballGeo,material,boxgeo,boxmat;
var steve,cab,tor,bds,bdi,bes,bei,pds,pdi,pes,pei;
var acab,ator,abds,abdi,abes,abei,apds,apdi,apes,apei;

var plomat,plogeo,plo;
var mov=0.1;var mousedu=0;var movemouse=0;
var mH=0;var mV=0;var mob=0;var hip=0;

var ma=[];var ka=[];var alvos=[];

var cuma,kuma,stegeo,plotex;

var cabgeo;


var keys=[];
var ang=0;


var bate;




		const renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		container.appendChild( renderer.domElement );

		//renderer.shadowMapEnabled=true;


		const scene=new THREE.Scene();
		scene.background=new THREE.Color(0x006699);
		const camera=new THREE.PerspectiveCamera(100,window.innerWidth/window.innerHeight,.5,2000);
		//camera.position.set(0,5,30);
		camera.position.set(0,-30,10);
		camera.position.set(0,0,0);

// luzes
	const ambientLight=new THREE.AmbientLight("#fff",1);
	ambientLight.position.set(30,20,30);
ambientLight.castShadow=true;
	scene.add(ambientLight);

	point=new THREE.PointLight(0xff9900,3,3,2);//color,intensity,range,decay
	point.position.set(0,-1,27);

	var sun=new THREE.PointLight(0xffcc99,3,3,2);
	sun.castShadow=true;
	sun.position.set(-100,200,27);
	scene.add(sun);


//nave[0]=ACube.clone();

	var goldenrodT=new THREE.TextureLoader().load('models/lajinha_amarela-are-1.jpg');
	goldenrodT.wrapS=THREE.RepeatWrapping;
	goldenrodT.wrapT=THREE.RepeatWrapping;
	goldenrodT.repeat.set(12,6);
	var goldenrodG=new THREE.BoxGeometry(22,0.1,9);
	var goldenrodM=new THREE.MeshBasicMaterial({map:goldenrodT});
	var goldenrodB=new THREE.Mesh(goldenrodG,goldenrodM);
	goldenrodB.position.set(-13,0.1,-9);
	scene.add(goldenrodB);





	cubeGeometry=new THREE.BoxGeometry(1.5,5,1.5);
	cubeMaterial=new THREE.MeshBasicMaterial({color:0x990000,transparent:true,opacity:1});
	var CCube=new THREE.Mesh(cubeGeometry,cubeMaterial);
	CCube.position.set(5,2.5,-5);
scene.add(CCube);

	cubeMaterial=new THREE.MeshBasicMaterial({color:0x006699});
	var DCube=new THREE.Mesh(cubeGeometry,cubeMaterial);
	//DCube.castShadow=true;
	DCube.position.set(3,2.5,0);

scene.add(DCube);

	cubeMaterial=new THREE.MeshBasicMaterial({color:0x996699});
	var ECube=new THREE.Mesh(cubeGeometry,cubeMaterial);
	//ECube.castShadow=true;
	ECube.position.set(6,2.5,0);
scene.add(ECube);

	cubeMaterial=new THREE.MeshBasicMaterial({color:0x000099});
	var FCube=new THREE.Mesh(cubeGeometry,cubeMaterial);
	//FCube.castShadow=true;
	FCube.position.set(9,2.5,0);
scene.add(FCube);

	cubeMaterial=new THREE.MeshLambertMaterial({color:0xff00ff,wireframe:true,transparent:true,opacity:0.3});
	bate=new THREE.Mesh(cubeGeometry,cubeMaterial);
	bate.position.set(0,0,0);
	bate.scale.set(0.2,0.2,0.2);
//scene.add(bate);


	var cubeGeo=new THREE.BoxGeometry(1,1,1);
	cubeMaterial=new THREE.MeshBasicMaterial({color:0x000000});
	var camA=new THREE.Mesh(cubeGeo,cubeMaterial);
	//camA.scale.set(5,5,5);
	//camA.position.set(0,15,0);

	cubeMaterial=new THREE.MeshBasicMaterial({color:0xffff00});
	var camB=new THREE.Mesh(cubeGeo,cubeMaterial);
	camB.scale.set(5,5,5);
	//camB.position.set(0,15,40);


// GRIDS
	var gridBaseGeo=new THREE.BoxGeometry(100,100,0.01);
	var gridBaseMat=new THREE.MeshPhongMaterial({color:0x444444});
	var gridBase=new THREE.Mesh(gridBaseGeo,gridBaseMat);
	gridBase.position.set(0,0,0);
	gridBase.rotation.x=de2ra(90);
	gridBase.receiveShadow=true;
	scene.add(gridBase);

	var gridBaseMat=new THREE.MeshPhongMaterial({color:0x001122});
	var gridBase=new THREE.Mesh(gridBaseGeo,gridBaseMat);
	gridBase.position.set(0,-0.1,0);
	gridBase.rotation.x=de2ra(90);
	gridBase.receiveShadow=true;
	scene.add(gridBase);

	var grid=new THREE.GridHelper(100,50);//size,divisions
	grid.material.color.setHex(0xffffff);
	grid.position.set(0,0.1,0);
	grid.receiveShadow=true;
	scene.add(grid);

//RUAS
	var ruaGeo=new THREE.BoxGeometry(100,2,0.01);
	var ruaMat=new THREE.MeshPhongMaterial({color:0x303030});
	var Arua=new THREE.Mesh(ruaGeo,ruaMat);
	Arua.position.set(0,0.2,0);
	Arua.rotation.set(de2ra(90),0,de2ra(90));
	Arua.receiveShadow=true;
	scene.add(Arua);

	ruaGeo=new THREE.BoxGeometry(100,2,0.01);
	ruaMat=new THREE.MeshPhongMaterial({color:0x303030});
	var Brua=new THREE.Mesh(ruaGeo,ruaMat);
	Brua.position.set(0,0.2,-25);
	Brua.rotation.set(de2ra(90),0,de2ra(0));
	Brua.receiveShadow=true;
	scene.add(Brua);

// sky
	const loader = new THREE.TextureLoader();
	loader.load('models/sky_cores_3.jpg',function(texture){
	//texture.encoding=THREE.sRGBEncoding;
	texture.mapping=THREE.EquirectangularReflectionMapping;
	scene.background=texture;  
});
	//goldenrod
		const textureA=new THREE.TextureLoader().load('img/fl4.jpg');
		textureA.wrapS=THREE.RepeatWrapping;
		textureA.wrapT=THREE.RepeatWrapping;
		textureA.repeat.set(5,1);
		var geoA=new THREE.BoxGeometry(5,10,5);
		const matA=new THREE.MeshBasicMaterial({map:textureA,side:THREE.DoubleSide});
		var ACube=new THREE.Mesh(geoA,matA);
		ACube.position.set(-15,5,-9);
		scene.add(ACube);

	// steve
//	var mats=['images/steve_ypos.png','images/steve_ypos.png','images/steve_ypos.png','images/steve_ypos.png','images/steve_ypos.png','images/steve_tar.png',
//	].map(pic =>{return new THREE.MeshLambertMaterial({map:loader.load(pic)});});
//	steve=new THREE.Mesh(cubeGeo,mats);
//	steve.position.set(0,3,0);
//	steve.rotation.z=1.57;

	var matZ=[
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_ypos.png')}),
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_ypos.png')}),
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_ypos.png')}),
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_ypos.png')}),
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_ypos.png')}),
	new THREE.MeshBasicMaterial({map:loader.load('images/steve_tar.png')}),
	];
	steve=new THREE.Mesh(cubeGeo,matZ);
	steve.position.set(0,3,0);
	steve.rotation.z=1.57;

	// heli[0]
	var cubeGeometry=new THREE.BoxGeometry(1,1,1);
	var cubeMaterial=new THREE.MeshBasicMaterial({color:'#069',transparent:true,opacity:1});
	heli[0]=new THREE.Mesh(cubeGeometry,cubeMaterial);


heli[2]=heli[0].clone();
heli[2].position.set(0,3,-1.2);
heli[2].scale.set(7,7,5);
scene.add(heli[2]);

ACube.name="Gigante";
CCube.name="Vermelho";
DCube.name="Azul claro";
ECube.name="Pink";
FCube.name="Azul";

alvos.push(ACube);
alvos.push(CCube);
alvos.push(DCube);
alvos.push(ECube);
alvos.push(FCube);


window.onresize=function(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
};




// **** touchmove ini ****

document.addEventListener("touchmove", mymove);
document.addEventListener("touchend", myend);

function mymove(event) {
	xx=parseInt(event.touches[0].clientX);
	yy=parseInt(event.touches[0].clientY);
	//document.getElementById("spanaux").innerText="touch";
	compu();
	repo();
}

function myend(event) {
	teclaW=0;
	teclaV=0;
	teclaH=0;
	teclaG=0;
	teclaB=0;
	teclaC=0;
}
// **** touchmove end ****


// **** mousemove ini ****

document.addEventListener("mousemove",function(){
	if(mousedu==1){
		movemouse=1;
		xx=event.pageX;yy=event.pageY;
		compu();
//		if(plo){plo.rotation.y=-camera.rotation.y;}
	}
});

document.addEventListener("mousedown",function(){
	mousedu=1;
	if(mousedu==1){
		movemouse=1;
		xx=event.pageX;yy=event.pageY;
		compu();
	}
});

document.addEventListener("mouseup",function(){
	mousedu=0;
	movemouse=0;

	teclaW=0;
	teclaV=0;
	teclaH=0;
	teclaG=0;
	teclaB=0;
	teclaC=0;

});

// **** mousemove fim ****

function compu(){
repo();
/*
	if(xx>xxant){
		if(camera.position.x<1600){teclaG=1;}
	}else{
		if(camera.position.x>-1600){teclaH=1;}
	}
	if(yy>yyant){
		if(camera.position.y>-1600){teclaW=1;}
	}else{
		if(camera.position.y<1600){teclaV=1;}
	}

*/
	if(xx<=mH && yy<mV){
		teclaW=0;teclaV=0;teclaH=0;teclaG=0;
		teclaW=1;teclaG=1;
	}
	if(xx<=mH && yy>mV){
		teclaW=0;teclaV=0;teclaH=0;teclaG=0;
		teclaV=1;teclaG=1;
	}
	if(xx>=mH && yy<mV){
		teclaW=0;teclaV=0;teclaH=0;teclaG=0;
		teclaW=1;teclaH=1;
	}
	if(xx>=mH && yy>mV){
		teclaW=0;teclaV=0;teclaH=0;teclaG=0;
		teclaV=1;teclaH=1;
	}

	xxant=xx;
	yyant=yy;
document.getElementById("spanaux").innerText=xxant+ " ...  " + yyant;

}


function repo(){
	mH=window.innerWidth/2;mV=window.innerHeight/2;
}

function animate() {
	requestAnimationFrame(animate);

	ww++;

	if(ww==5){
	//camA.position.set(0,-5,-50);
	camA.position.set(0,40,-50);
	camB.position.set(0,0,40);
		bate.position.set(0,0,5);
		bate.scale.set(0.5,0.5,1);
		steve.add(bate);
		heli[0].add(steve);
		heli[0].add(heli[2]);
		heli[0].add(point);
	heli[0].add(camA);
	heli[0].add(camB);

		steve.position.set(0,7.9,12);
		steve.scale.set(10,10,10);

		//heli[2].position.set(0,12.5,12);
		//heli[2].rotation.set(p/3,0,p/3);

		heli[0].scale.set(.01,.01,.01);
		heli[0].rotation.set(0,3.14,0);
		heli[0].position.set(0,0.5,0);
		scene.add(heli[0]);


	}

		scene.updateMatrixWorld(true);
			//target.getPositionFromMatrix(bone[0].matrixWorld);
		target.setFromMatrixPosition(camB.matrixWorld);
			//alert(target.x + ',' + target.y + ',' + target.z);
		camera.lookAt(target.x,target.y,target.z);

		scene.updateMatrixWorld(true);
		target.setFromMatrixPosition(camA.matrixWorld);
		camera.position.set(target.x,target.y,target.z);

		w++;

		//heli[1].rotation.y -=0.1;
//		heli[2].rotation.y -=0.1;

//heli[0].rotation.y -=0.01;

//steve.rotation.z=p;

		if(teclaW==1){heli[0].rotation.y=-3.14+ang;	heli[0].position.z +=Math.cos(heli[0].rotation.y=-3.14+ang)*mov;	heli[0].position.x +=Math.sin(heli[0].rotation.y=-3.14+ang)*mov;		scene.position.z -=Math.cos(heli[0].rotation.y=-3.14+ang)*mov;	scene.position.x -=Math.sin(heli[0].rotation.y=+3.14+ang)*mov;}//W
		if(teclaV==1){heli[0].rotation.y=-3.14+ang;	heli[0].position.z -=Math.cos(heli[0].rotation.y=-3.14+ang)*mov;	heli[0].position.x -=Math.sin(heli[0].rotation.y=-3.14+ang)*mov;		scene.position.z +=Math.cos(heli[0].rotation.y=-3.14+ang)*mov;	scene.position.x +=Math.sin(heli[0].rotation.y=+3.14+ang)*mov;}//V
		if(teclaH==1){heli[0].rotation.y -=.02;ang-=.02;}//G
		if(teclaG==1){heli[0].rotation.y +=.02;ang+=.02;}//H

		if(teclaB==1){if(heli[0].position.y>0.4){heli[0].position.y -=mov/2;}}//Cima
		if(teclaC==1){heli[0].position.y +=mov/2;}//Baixo
/*
teclaW=0;
teclaV=0;
teclaH=0;
teclaG=0;
teclaB=0;
teclaC=0;
*/



	if(bate){

		scene.updateMatrixWorld(true);
		target.setFromMatrixPosition(bate.matrixWorld);

		originPoint=target.setFromMatrixPosition(bate.matrixWorld);
		//originPoint.y=originPoint.y+2.5;
		//originPoint.x=originPoint.x-0.7;
		//originPoint.z=originPoint.z-0.7;
		for(vertexIndex=0;vertexIndex<bate.geometry.vertices.length;vertexIndex++){		
			localVertex=bate.geometry.vertices[vertexIndex].clone();
			globalVertex=localVertex.applyMatrix4(bate.matrix);
			directionVector=globalVertex.sub(bate.position);
			ray=new THREE.Raycaster(originPoint,directionVector.clone().normalize());
			collisionResults=ray.intersectObjects(alvos);
			if(collisionResults.length>0 && collisionResults[0].distance<directionVector.length()){
			document.getElementById("spanaux2").innerText="Hit ... "+ collisionResults[0].object.name;
		//scene.getObjectByName(collisionResults[0].object.name,true).scale.set(0,0,0);som.play();
		//if(collisionResults[0].object.name=="box5"){gru.scale.set(0,0,0);}
		//if(collisionResults.length>0){w=0;}
			}	
		}
	}





	renderer.render( scene, camera );
}



animate();

</script>

</body>
</html>
