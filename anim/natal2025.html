<!DOCTYPE html>
<html lang="en">
<head>
<title>natal2025.html</title>
<meta charset="utf-8">

<link rel="icon" type="image/png" href="../img/github-mark.png">
<meta name="description" content="Natal 2025">
<meta name="twitter:image" content="img/ag_baboy_right.png" />
<meta name="twitter:image:type" content="png" />
<meta name="twitter:image:width" content="19" />
<meta name="twitter:image:height" content="47" />

<style>
@font-face {font-family:myq;src:url('../fonte/MysteryQuest-Regular.ttf');}
body {margin:0; overflow:hidden; background:#222; color:#ff0; font-family:myq;}
span {position:absolute; left:10px; top:10px; font-size:41pt;}
</style>

<script type="importmap">
	{
	"imports":{
	"three":"https://unpkg.com/three@0.181.0/build/three.module.js",
	"three/addons/":"https://unpkg.com/three@0.181.0/examples/jsm/"
	}
	}
</script>

</head>

<body>

<span>
<i style="color:#0ff;">Ch</i><i style="color:#f00;">ri</i><i style="color:#cf0;">st</i><i style="color:#f0f;">ma</i><i style="color:#99f;">s</i>
 <i style="color:#f90;">Tr</i><i style="color:#0f0;">ee</i>
</span>
<span id="clo" style="width:99%;top:40%;text-align:center;">Please wait a moment...</span>

<script type="module">

import * as THREE from 'three';
import {GUI} from 'three/addons/libs/lil-gui.module.min.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
import { ShaderPass} from 'three/addons/postprocessing/ShaderPass.js';
import { OutputPass} from 'three/addons/postprocessing/OutputPass.js';
import { RoomEnvironment} from 'three/addons/environments/RoomEnvironment.js';
import { Line2 } from 'three/addons/lines/Line2.js';
import { LineMaterial } from 'three/addons/lines/LineMaterial.js';
import { LineGeometry } from 'three/addons/lines/LineGeometry.js';

var AdditiveBlendShader={
	uniforms:{baseTexture:{value:null},bloomTexture:{value:null}},
	vertexShader:`varying vec2 vUv;
	void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
	fragmentShader:`uniform sampler2D baseTexture;
	uniform sampler2D bloomTexture;
	varying vec2 vUv;
	void main(){gl_FragColor=texture2D(baseTexture,vUv)+texture2D(bloomTexture,vUv);}`
};


var renderer, scene, camera, controls, line, matLine, divs, color, spline, lineGeometry;
var point=new THREE.Vector3();
var positions=[];
var colors=[];
var points=[];
var curvefactor=9;

var group=[];for(let z=1;z<100;z++){group[z]=new THREE.Group();}

var p=Math.PI;
var g=[];for(let z=1;z<100;z++){g[z]=new THREE.Group();}
var ax=[];for(let z=1;z<100;z++){ax[z]=new THREE.AxesHelper(1);}
var pp=[];
var box=[];
var lig=[];
var sig=1;
var  ball, cyl, tex, piso;
var rot=0;
var t=0;
var gui, geo, mat, sig, color, Sp=[];

var B_L, bloomLayer, darkMaterial, materials={}, renderPass, bloomPass, bloomComposer, finalComposer, blendPass;
var element=document.getElementById("clo");
var bloomFolder,toneMappingFolder;
const params={strength:0.5,radius:0,exposure:0.4};



function init(){

	renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.toneMapping=THREE.ReinhardToneMapping;
	renderer.setSize(window.innerWidth,window.innerHeight);
	renderer.colorSpace=THREE.SRGBColorSpace;

	camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.1,1000,1);
	camera.position.set(0,200,400);

	scene=new THREE.Scene();
	scene.environment=new THREE.PMREMGenerator(renderer).fromScene(new RoomEnvironment(),0.04).texture;
	scene.position.y=-50;

	renderer.setClearColor('#024',0);

	document.body.appendChild(renderer.domElement);

	controls=new OrbitControls(camera,renderer.domElement);

	window.addEventListener('resize',onWindowResize);

	lig[1]=new THREE.AmbientLight('#fff',0.1);scene.add(lig[1]);
	lig[2]=new THREE.PointLight('#fff',100000);lig[2].position.set(80,100,200);scene.add(lig[2]);
	lig[3]=new THREE.PointLight('#0ff',100000);lig[3].position.set(-80,100,200);scene.add(lig[3]);

	tex=new THREE.TextureLoader().load('images/a_grass.jpg');
	tex.colorSpace=THREE.SRGBColorSpace;
	piso=new THREE.Mesh(new THREE.CircleGeometry(150),new THREE.MeshStandardMaterial({color:'#696',map:tex,side:THREE.DoubleSide}));
	piso.position.set(0,-130,0);
	piso.rotation.x=p/2;

	geo=new THREE.SphereGeometry(12,64,64);
	for(let i=1;i<35;i++){
		sig=-sig;
		color=new THREE.Color();color.setHSL(Math.random(),0.7,Math.random()*0.2+0.05);
		mat=new THREE.MeshStandardMaterial({color:color,roughness:0.1,metalness:0.7});
		Sp[i]=new THREE.Mesh(geo,mat);
		Sp[i].position.x=Math.random()*130*sig;
		Sp[i].position.y=-50+Math.random()*250;
		Sp[i].position.z=Math.random()*150*sig;
	}
	Sp[0]=new THREE.Mesh(geo,new THREE.MeshStandardMaterial({color:'#fff',roughness:0.1,metalness:0.5}));
	Sp[0].scale.set(2,1.6,2);
	Sp[0].position.set(0,234,0);

cyl=new THREE.Mesh(new THREE.CylinderGeometry(2,7,360),new THREE.MeshStandardMaterial({color:'#640'}));
cyl.position.set(0,50,0);
scene.add(cyl);

box[1]=new THREE.Mesh(new THREE.BoxGeometry(0.1,0.1,0.1),new THREE.MeshStandardMaterial({color:'#000'}));

ball=new THREE.Mesh(new THREE.SphereGeometry(12,16,16,0,0.7,0,p),new THREE.MeshStandardMaterial({color:'#096',side:THREE.DoubleSide}));
ball.rotation.set(0.10,0,p/1.7);
ball.position.set(19,0,0);
ball.scale.set(1.9,3,1);

box[1].add(ball);
box[1].scale.set(0.5,0.5,0.75);

//group[1]=box[1].clone();

rot=0;
for(let z=1;z<7;z++){
	rot=rot+p/3;
	box[z]=box[1].clone();
	box[z].rotation.y=rot;
	group[1].add(box[z]);
}

rot=p/6; // aqui replicava e virava
for(let z=8;z<14;z++){
	rot=rot+p/6;
	box[z]=box[1].clone();
	box[z].rotation.set(0,rot,0);
	box[z].scale.set(0.5,0.5,0.5);
	box[z].position.set(0,-20,0);
	group[1].add(box[z]);
}
//scene.add(group[1]);

group[2]=group[1].clone();
group[2].position.set(14,0,0);
group[2].rotation.set(0,0,p/2);
//scene.add(group[2]);

// menores no centro
group[3]=group[1].clone();
group[3].scale.set(0.75,0.75,0.75);
group[3].position.set(80,-12,0);
group[3].rotation.set(0,0,p/2);
//scene.add(group[3]);

	pp[0]=new THREE.Vector2(0,0);
	pp[1]=new THREE.Vector2(5,-3);
	pp[2]=new THREE.Vector2(15,-3);
	pp[3]=new THREE.Vector2(20,0);
	spline=new THREE.SplineCurve(pp);
	divs=curvefactor*(pp.length-1);
	for(let i=0;i<divs;i++){
		const t=i/divs;
		spline.getPoint(t,point);
		positions.push(point.x,point.y,point.z);
	}
	matLine=new LineMaterial({color:'#960',linewidth:4,});
	lineGeometry=new LineGeometry();
	lineGeometry.setPositions(positions);
	line=new Line2(lineGeometry,matLine);
	line.computeLineDistances();
	line.scale.set(9.4,4,2);
	line.position.set(28,0,0);
	//scene.add(line);

g[1].add(group[2]);
g[1].add(group[3]);
g[1].add(line);
//scene.add(g[1]);

g[1].position.set(-220,0,0);
ax[1].add(g[1]);
g[2].add(ax[1]);

rot=0;
for(let z=2;z<7;z++){
	rot=rot+p/3;
	ax[z]=ax[1].clone();
	ax[z].rotation.set(0,rot,0);;
	g[2].add(ax[z]);
}
//scene.add(g[2]); // 1a

//					ACERTAR ALTURA DAS FOLHINHAS

g[3]=g[2].clone(); // 2a
g[3].position.set(0,50,0);
g[3].scale.setScalar(0.8);
g[3].rotation.set(0,p/6,0);

g[4]=g[2].clone(); // 3a
g[4].position.set(0,100,0);
g[4].scale.setScalar(0.7);
g[4].rotation.set(0,p/3,0);

g[5]=g[2].clone(); // 4a
g[5].position.set(0,150,0);
g[5].scale.setScalar(0.6);
g[5].rotation.set(0,p/6,0);

g[6]=g[2].clone(); // 5
g[6].position.set(0,180,0);
g[6].scale.setScalar(0.4);
g[6].rotation.set(0,p/3,0);

g[7]=g[2].clone(); // 6
g[7].position.set(0,210,0);
g[7].scale.setScalar(0.3);
g[7].rotation.set(0,p/6,0);

for(let z=2;z<8;z++){g[12].add(g[z]);}
g[12].add(cyl);
g[12].add(piso);

for(let k=0;k<25;k++){g[12].add(Sp[k]);}

scene.add(g[12]);

	B_L=1;
	bloomLayer=new THREE.Layers();
	bloomLayer.set(B_L);

	ball.layers.disable(B_L);

	darkMaterial=new THREE.MeshBasicMaterial({color:'black'});
	renderPass=new RenderPass(scene,camera);
	bloomPass=new UnrealBloomPass(new THREE.Vector2(innerWidth,innerHeight),1.2,0.4,0.0);
	bloomComposer=new EffectComposer(renderer);
	bloomComposer.renderToScreen=false;
	bloomComposer.addPass(renderPass);
	bloomComposer.addPass(bloomPass);
	finalComposer=new EffectComposer(renderer);
	finalComposer.addPass(renderPass);
	blendPass=new ShaderPass(AdditiveBlendShader,'baseTexture');
	blendPass.uniforms.bloomTexture.value=bloomComposer.renderTarget2.texture;
	finalComposer.addPass(blendPass);
	finalComposer.addPass(new OutputPass());

	bloomPass.strength=0.7;
	bloomPass.radius=0;
	renderer.toneMappingExposure=0.6;

}

function onWindowResize(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
}

function darkenNonBloomed(obj){	if(obj.isMesh && !bloomLayer.test(obj.layers)){	materials[obj.uuid]=obj.material;obj.material=darkMaterial;}}
function restoreMaterial(obj){if(materials[obj.uuid]){obj.material=materials[obj.uuid];delete materials[obj.uuid];}}

function animate(){
	requestAnimationFrame(animate);
	if(element){element.remove();}

	scene.traverse(darkenNonBloomed);
	bloomComposer.render();
	scene.traverse(restoreMaterial);

	t=t+0.5;

	bloomPass.strength=t/80;

	if(t==2){
		color.setHSL(Math.random(),0.7,Math.random()*0.2+0.05);
		scene.remove(Sp[0]);
		Sp[0]=new THREE.Mesh(geo,new THREE.MeshStandardMaterial({color:color,roughness:0.1,metalness:0.5}));
		Sp[0].position.set(0,234,0);
		Sp[0].scale.set(2,1.6,2);
		scene.add(Sp[0]);
		bloomPass.strength=0.7;
	}
	if(t==50){for(let k=0;k<35;k++){Sp[k].layers.toggle(B_L);}}
	if(t==100){for(let k=0;k<35;k++){Sp[k].layers.toggle(B_L);}}
	if(t==110){t=0;bloomPass.strength=0}
	if(g[12]){g[12].rotation.y +=0.01;}

	if(controls){controls.update();}
	finalComposer.render();
}

init();
animate();

</script>
</body>
</html>
