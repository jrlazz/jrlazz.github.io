<!DOCTYPE html>
<html lang="en">
<head>
<title>donut.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="https://threejs.org/files/favicon.ico"/>

<style>
body{margin:0px;border:0px;background-color:#002244;font-family:Monospace;overflow:hidden;}
span{position:absolute;color:#008;font-size:16pt;cursor:pointer;}
</style>

</head>

<body>

<span id="spanA" style="left:10px;top:5px;">right click &rarr; inspect &rarr; source code</span>

<div id="container"></div>

<script type="module">

import * as THREE from '../js/three.module_res_res.js';
import { OrbitControls } from '../js/OrbitControls_res_res.js';
import { DDSLoader } from '../js/DDSLoader_res_res.js';
import { MTLLoader } from '../js/MTLLoader_res_res.js';
import { OBJLoader } from '../js/OBJLoader_res_res.js';

var container, manager, stats, controls, loader;
var camera, scene, renderer;
var fix={};
var GGK={};
var w=0;
var k=0;

init();
animate();

function init() {
	camera = new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,0.1,1000);
	camera.position.set(0,20,20);
	scene=new THREE.Scene();

	renderer= new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor(0x002244,1);
	document.body.appendChild(renderer.domElement);
	renderer.shadowMap.enabled=true;

	controls=new OrbitControls(camera,renderer.domElement);

	manager=new THREE.LoadingManager();
	manager.onStart=function(url,itemsLoaded,itemsTotal){console.log('Started loading file:'+url+'.\nLoaded '+itemsLoaded+' of '+itemsTotal + ' files.' );};
	manager.onLoad=function(){console.log('Loading complete!');};
	manager.onProgress=function(url,itemsLoaded,itemsTotal){console.log('loading texture'+url+' '+(itemsLoaded/itemsTotal*100)+'%');};
	manager.onError=function(url){console.log('Error loading texture:'+url);};
	manager.addHandler(/\.dds$/i,new DDSLoader());

	new MTLLoader(manager).load('models/extras/collada.mtl',function(mat){mat.preload();new OBJLoader(manager).setMaterials(mat).load('models/extras/collada.obj',function(object){object.children[k].castShadow=true;fix[2]=object;scene.add(fix[2]);},manager.onProgress,manager.onError);});

	var texGGK=new THREE.TextureLoader(manager).load('img/blender_cor_04.jpg');
	texGGK.wrapS=THREE.RepeatWrapping;texGGK.wrapT=THREE.RepeatWrapping;
	texGGK.repeat.set(2,2);
	var matGGK=new THREE.MeshStandardMaterial({map:texGGK,color:('#fff'),transparent:true});
	var geoGGK=new THREE.BoxGeometry(160,160,1);
	GGK[1]=new THREE.Mesh(geoGGK,matGGK);
	GGK[1].rotation.set(1.57,0,1.57);
	GGK[1].position.set(0,-2.5,0);
	GGK[1].receiveShadow=true;
	scene.add(GGK[1]);

	var starB=new THREE.PointLight("#fff",1.5);starB.castShadow=true;starB.shadow.mapSize.width=2048;starB.shadow.mapSize.height=2048;scene.add(starB);
	var ambient=new THREE.AmbientLight("#fc9",0.7);scene.add(ambient);
	starB.position.set( -250,250, -250);

	window.addEventListener('resize',onWindowResize);

}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );
}

function animate(){
	requestAnimationFrame(animate);
	render();
	controls.update();
}

function render(){
	if(fix[2]){fix[2].rotation.y -=0.05;}
	renderer.render(scene,camera);
}

</script>
</body>
</html>
