<!DOCTYPE html>
<html lang="en">
<head>
<title>rounded_tubes_3.html</title>
<meta charset="utf-8">
<link rel="icon" type="image/png" href="img/github-mark.png">
<meta name="description" content="Rounded Tube with SVG and ExtrudeGeometry">
<meta name="twitter:image" content="img/ag_baboy_right.png" />
<meta name="twitter:image:type" content="png" />
<meta name="twitter:image:width" content="19" />
<meta name="twitter:image:height" content="47" />
<style>
body{overflow:hidden;margin:0px;font-family:Arial;background-color:#048;}
button {position:absolute;left:20px;top:40px;width:30px;font-family:Arial;font-size:18pt;font-weight:bold;color:red;border-radius:2%;cursor:pointer}
</style>

</head>

<script type="importmap">{"imports":{"three":"https://esm.sh/three@0.175.0/build/three.module.js","three/addons/":"https://esm.sh/three@0.175.0/examples/jsm/"}}</script>

<body>

<span id="spb" style="position:absolute;top:3%;width:99%;font-size:20.5pt;color:#c90;text-align:center;display:''">... Rounded Tube with SVG and ExtrudeGeometry ... 90&#186; and 150&#186; </span>

<script type="module">

import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
import { SVGLoader } from 'three/addons/loaders/SVGLoader.js';

var camera, scene, renderer, loader, controls, text, font;
var luz;
var mesh=[];
var grc=new THREE.Group(), grd=new THREE.Group();
var sim=0;
var p=Math.PI;
var paths=[], shapes=[], depth, bevelEnabled,material,geometry, mat, extrusion=5;

	camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1000);
	camera.position.set(0,0,100);
	scene=new THREE.Scene();
	scene.rotation.x=p/3;
	scene.position.y=-20;

	renderer=new THREE.WebGLRenderer({antialias:true});
	renderer.setSize(window.innerWidth,window.innerHeight);
	document.body.appendChild(renderer.domElement);
	renderer.setClearColor('#048',1.0);

	controls=new OrbitControls(camera,renderer.domElement);

	window.addEventListener('resize',onWindowResize,false);

	luz=new THREE.AmbientLight("#fff",5);scene.add(luz);

	loadSVG('img/100x96.svg',1);
	loadSVG('img/anel.svg',2);

function loadSVG(url,q){
	loader=new SVGLoader();
	loader.load(url,function(data){
		paths=data.paths;
		let i=0;
		//for(let i=0;i<paths.length;i++){
			mat=[new THREE.MeshStandardMaterial({color:'#c0c',transparent:true,opacity:1,metalness:0.5,roughness:0.2}),new THREE.MeshStandardMaterial({color:'#cc0',transparent:true,opacity:1,metalness:0.5,roughness:0.2})];
			shapes=SVGLoader.createShapes(paths[i]);
			//for(let j=0;j<shapes.length;j++){
				let j=0;
				geometry=new THREE.ExtrudeGeometry(shapes[j],{depth:extrusion,bevelEnabled:true,curveSegments:1});
				if(q==2){
					//geometry.translate(-50,-50,0);
					mesh[30]=new THREE.Mesh(geometry,mat);
					mesh[30].scale.setScalar(0.2);
					mesh[30].geometry.translate(40,40,0);
					mesh[30].position.set(0,0,20);
				}
				if(q==1){
					mesh[31]=new THREE.Mesh(geometry,mat);
					mesh[31].scale.setScalar(0.2);
					mesh[31].geometry.translate(50,50,0);
					mesh[31].position.set(0,0,-20);
				}
			//}
		//}
	});
}

function onWindowResize(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate() {
	requestAnimationFrame(animate);
	if(mesh[30] && mesh[31] && sim==0){
		for(let z=40;z<300;z++){
			mesh[z]=mesh[30].clone();mesh[z].rotation.y=(z-40)/30;// cuidado aqui vale y
			if(mesh[z].rotation.y<=p/1.2){grc.add(mesh[z]);scene.add(grc);}// lembre aqui vale y

			mesh[100+z]=mesh[31].clone();mesh[100+z].rotation.y=(z-40)/30;// cuidado aqui vale y
			if(mesh[100+z].rotation.y<=p/2){grd.add(mesh[100+z]);scene.add(grd);}// lembre aqui vale y

		}
		sim=1;
	}
	renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>