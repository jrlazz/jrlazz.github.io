<!DOCTYPE html>
<html lang="en">
<head>
<title>tween_01.html</title>
<meta charset="utf-8">
<link rel="shortcut icon" href="ok.ico"/>

<style>
body{margin:0px;background-color:#48c;font-family:Monospace;overflow:hidden;}
</style>

<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
	{
		"imports":{
			"three":"https://unpkg.com/three@0.158.0/build/three.module.js",
			"three/addons/":"https://unpkg.com/three@0.158.0/examples/jsm/"
		}
	}
</script>

</head>

<body>

<span style="position:absolute;left:10px;top:10px;color:#ff0;font-size:20.5px;">Tween... Keys Y and N</span>
<img src="img/rgbmapS.png" style="position:absolute;left:-200px;"></img>
<button style="position:absolute;left:84%;top:84%;background-color:#ccc;text-align:center;"><a id="code" href="tween_01.txt" target="_blank" style="color:#009;text-decoration:none;font-size:16pt;">The Code</a></button>

<script type="module">

import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import * as TWEEN from "three/addons/libs/tween.module.js";

var scene,camera,renderer,controls,light,texcarpet,carpet,wobbleHead;
var clock=new THREE.Clock();
var t=0;

class WobbleHead extends THREE.Group{
	constructor() {
		super();

		let tex=new THREE.TextureLoader().load("img/256tra.png");
		tex.colorSpace=THREE.SRGBColorSpace;
		tex.wrapS=THREE.RepeatWrapping;tex.wrapT=THREE.RepeatWrapping;
		tex.repeat.set(3,3);
		let mat=new THREE.MeshLambertMaterial({map:tex});
		
		let hair=new THREE.Mesh(new THREE.SphereGeometry(0.6,8,8),new THREE.MeshLambertMaterial({map:tex}));
		hair.position.set(-0.5,0.4,0);
		hair.scale.set(1,1,1.5);

		let arm1=new THREE.Mesh(new THREE.CapsuleGeometry(0.4,1,3,16).translate(0,1.5,0),new THREE.MeshLambertMaterial({color:'#fff',map:tex}));
		arm1.position.set(0,2,-0.5);
		arm1.rotation.set(Math.PI/2,0,0);
		this.arm1=arm1;
		let arm2=new THREE.Mesh(new THREE.CapsuleGeometry(0.4,1,3,16).translate(0,1.5,0),new THREE.MeshLambertMaterial({color:'#fff',map:tex}));
		arm2.position.set(0,2,-2.5);
		arm2.rotation.set(Math.PI/2,0,0);
		this.arm2=arm2;
		let leg1=new THREE.Mesh(new THREE.CapsuleGeometry(0.4,2,3,16).translate(0,1.5,0),new THREE.MeshLambertMaterial({color:'#fff',map:tex}));
		leg1.position.set(-0.5,0,0.5);
		leg1.rotation.set(Math.PI/2,0,-Math.PI/2);
		let leg2=new THREE.Mesh(new THREE.CapsuleGeometry(0.4,2,3,16).translate(0,1.5,0),new THREE.MeshLambertMaterial({color:'#fff',map:tex}));
		leg2.position.set(-0.5,0,-0.5);
		leg2.rotation.set(Math.PI/2,0,-Math.PI/2);

		let body=new THREE.Mesh(new THREE.CapsuleGeometry(0.5,2,10,16).translate(0,1.5,0),new THREE.MeshLambertMaterial({color:'#fff',map:tex}));
		body.add(arm1);
		body.add(arm2);
		body.add(leg1);
		body.add(leg2);

		let point1=new THREE.Mesh(new THREE.SphereGeometry(0.05,16,16),new THREE.MeshLambertMaterial({color:'#06c'}));
		point1.position.set(0.05,0.05,0);
		let eye1=new THREE.Mesh(new THREE.SphereGeometry(0.1,16,16),new THREE.MeshLambertMaterial({color:'#fff'}));
		eye1.position.set(0.2,0.45,-0.2);
		eye1.add(point1);
		let point2=new THREE.Mesh(new THREE.SphereGeometry(0.05,16,16),new THREE.MeshLambertMaterial({color:'#06c'}));
		point2.position.set(0.05,0.05,0);
		let eye2=new THREE.Mesh(new THREE.SphereGeometry(0.1,16,16),new THREE.MeshLambertMaterial({color:'#fff'}));
		eye2.position.set(0.2,0.45,0.2);
		eye2.add(point2);
		let nose=new THREE.Mesh(new THREE.SphereGeometry(0.1,16,16),new THREE.MeshLambertMaterial({color:'#da6'}));
		nose.position.set(0.4,0.4,0);
		let mouth=new THREE.Mesh(new THREE.SphereGeometry(0.1,16,16),new THREE.MeshLambertMaterial({color:'#f00'}));
		mouth.position.set(0.5,0.2,0);    

		let head=new THREE.Mesh(new THREE.IcosahedronGeometry(0.6,0),new THREE.MeshLambertMaterial({color:'#fc8'}));
		head.geometry.translate(0.1,0,0);

		head.position.set(0,3,0);
		head.rotation.set(0,0,-0.5);
		this.head=head;
		head.add(eye1);
		head.add(eye2);
		head.add(nose);
		head.add(mouth);
		head.add(hair);
    
		body.add(head);

		this.add(body);
    
		this.animations={
    			no:() => {
      				new TWEEN.Tween({val:0}).to({val:1},1000).onUpdate(val => {
        			this.head.rotation.y=Math.sin(val.val*Math.PI*3)*0.2;
				})
				.start();
				},
			yes:() => {
				new TWEEN.Tween({val:0}).to({val:1},1000).onUpdate(val => {
					this.head.rotation.z=-0.5+Math.sin(val.val*Math.PI*3)*0.2;
					this.arm1.rotation.y=Math.sin(val.val*Math.PI*6)*0.2;
					this.arm2.rotation.y=Math.sin(val.val*Math.PI*6)*0.2;
				})
				.start();
			}
		}
	}
}

scene=new THREE.Scene();
camera=new THREE.PerspectiveCamera(40,innerWidth/innerHeight,1,1000);
camera.position.set(10,5,10).setLength(15);

renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setClearColor('#069',0);
renderer.outputColorSpace=THREE.LinearSRGBColorSpace;
document.body.appendChild(renderer.domElement);

window.addEventListener("resize",event => {
	camera.aspect=innerWidth/innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(innerWidth,innerHeight);
})

controls=new OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;

light=new THREE.DirectionalLight('#fff',Math.PI);
light.position.setScalar(1);
scene.add(light,new THREE.AmbientLight('#fff',1));

texcarpet=new THREE.TextureLoader().load("img/carpet_01.png");
texcarpet.colorSpace=THREE.SRGBColorSpace;
carpet=new THREE.Mesh(new THREE.PlaneGeometry(10,8),new THREE.MeshLambertMaterial({map:texcarpet,side:THREE.DoubleSide}));
carpet.rotation.x=-Math.PI/2;
carpet.position.y=-0.4;
scene.add(carpet);

wobbleHead=new WobbleHead();
wobbleHead.position.z=0;
scene.add(wobbleHead);

window.addEventListener("keydown",event => {
	if(event.keyCode==78){wobbleHead.animations["no"]()};
  	if(event.keyCode==89){wobbleHead.animations["yes"]()};
})

renderer.setAnimationLoop(() => {
	let dt=clock.getDelta();
	t += dt;
	controls.update();
	TWEEN.update();
	renderer.render(scene,camera);
})

</script>

</body>

</html>
