<!DOCTYPE html>
<html lang="en">
<head>
<title>text_around.html</title>
<meta charset="utf-8" />
<link rel="icon" type="image/png" href="img/grad.png">
<meta name="description" content="FontLoader text around the cylinder">
<meta name="twitter:image" content="img/ag_baboy_right.png" />
<meta name="twitter:image:type" content="png" />
<meta name="twitter:image:width" content="19" />
<meta name="twitter:image:height" content="47" />

<script type="importmap">
  {
    "imports": {
      "three": "https://esm.sh/three@0.175.0/build/three.module.js",
      "three/addons/": "https://esm.sh/three@0.175.0/examples/jsm/"
    }
  }
</script>

<style>
body {margin:0;background-color:#036;font-family:Lucida Console;font-size:9pt;color:#ff0;overflow:hidden;}
</style>

</head>

<body>

<span style="position:absolute;width:99%;top:10px;font-size:16pt;color:#ff0;text-align:center;">FontLoader text around the cylinder</span>

<script type="module">

import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { Flow } from "three/addons/modifiers/CurveModifier.js";
import { FontLoader } from "three/addons/loaders/FontLoader.js";
import { TextGeometry } from "three/addons/geometries/TextGeometry.js";

var scene,camera,renderer,controls,flow,curve,curveHandles=[],curvePoints=[];

var degrad=Math.PI/180;

var s=[],c=[],v=[],sPoints=[];

for(let z=0;z<72;z++){
	s[z*5]=Math.sin((z*5)*degrad);c[z*5]=Math.cos((z*5)*degrad);
	v[z]=new THREE.Vector3(c[z*5],0,s[z*5]);
	sPoints.push(v[z]);
}
	scene=new THREE.Scene();
	camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,1,1000);
	camera.position.set(0,0,8);

	var curve=new THREE.CatmullRomCurve3(sPoints);

	var points=curve.getPoints(24);
	var line=new THREE.LineLoop(new THREE.BufferGeometry().setFromPoints(points),new THREE.LineBasicMaterial({color:'#f00'}));
	scene.add(line);

	for (const handlePos of sPoints){
		const handle=new THREE.Mesh(new THREE.BoxGeometry(0.02,0.02,0.02),new THREE.MeshStandardMaterial({color:'#fff'}));
		handle.position.copy(handlePos);
		curveHandles.push(handle);
		scene.add(handle);
	}

	curve.closed=true;

	const lig=new THREE.AmbientLight('#fff',2);scene.add(lig);

	const loader=new FontLoader();
	loader.load(
		"https://esm.sh/three@0.175.0/examples/fonts/helvetiker_regular.typeface.json",
		function (font) {
			const geometry=new TextGeometry("Hello Three.js!",{
				font:font,
				size:0.3,depth:0.03,curveSegments:2,
				bevelEnabled:true,
				bevelThickness:0.01,bevelSize:0.01,bevelOffset:0,bevelSegments:1
			})
			geometry.rotateX(Math.PI);geometry.rotateY(Math.PI);
			const fontmat=[new THREE.MeshStandardMaterial({color:'#036'}),new THREE.MeshStandardMaterial({color:'#c90'})];
			const objectToCurve=new THREE.Mesh(geometry,fontmat);
			flow=new Flow(objectToCurve)
			flow.updateCurve(0,curve)
			flow.moveAlongCurve(-0.2)
			scene.add(flow.object3D)
		}
	)

	renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setClearColor("#036",1);
	renderer.setSize(window.innerWidth,window.innerHeight);
	renderer.setAnimationLoop(animate);
	document.body.appendChild(renderer.domElement);
	controls=new OrbitControls(camera,renderer.domElement);
	window.addEventListener("resize",onWindowResize)

	const cylgeo=new THREE.CylinderGeometry(1,1,2,64,64,true);
	const cylmat=new THREE.MeshNormalMaterial();
	const cyl=new THREE.Mesh(cylgeo,cylmat);
	scene.add(cyl);

function onWindowResize(){
	camera.aspect=window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate(){
	if(flow){flow.moveAlongCurve(0.002)};
	renderer.render(scene,camera);
}

</script>
</body>
</html>