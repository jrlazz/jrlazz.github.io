<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>mouseshader2.html</title>
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
 <style>
@font-face{font-family:myq;src:url('../fonte/MysteryQuest-Regular.ttf');}
body{overflow: hidden;margin:0px;background-color:#024;}
</style>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.171.0/build/three.module.min.js",
      "three/addons/": "https://unpkg.com/three@0.171.0/examples/jsm/"
    }
  }
</script>



</head>
<body id="bo">
<span id="sp" style="position:absolute;width:99%;height:99%;top:41%;font-family:myq;font-size:41pt;color:#ff0;text-align:center;">Hello... with GPT help...</span>
<button style="position:absolute;left:2%;top:2%;background-color:#c90;text-align:center;"><a id="code" href="mouseshader.txt" target="_blank" style="color:#024;font-weight:bold;text-decoration:none;">The Code</a></button>

<script type="module">
	import * as THREE from 'three';

var w=0;


var bId=function(id){return document.getElementById(id);}
	var dbutcli=bId("sp");
	var dbo=bId("bo");

//ontouchstart="myFunction(event)" ontouchend="myFunction(event)" 	

	dbutcli.ontouchstart=function BC(){myFunction(event);}
	dbutcli.ontouchend=function BOC(){myFunction(event);}
	dbo.ontouchstart=function BO(){myFunction(event);}
	dbo.ontouchend=function BOO(){myFunction(event);}
	const scene = new THREE.Scene();

	const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
	camera.position.set(0,0,2);

	const renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});
	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.setClearColor(0x404040,0);
	document.body.appendChild(renderer.domElement);

alert(document.documentElement.clientWidth + " " +document.documentElement.clientHeight)


	// Vertex Shader
	const vertexShader = `
		varying vec2 vUv;
		void main() {
    		vUv = uv;
    		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}`

	// Fragment Shader
	const fragmentShader = `
	varying vec2 vUv;
	uniform float iTime;
	uniform vec2 iResolution;
	uniform vec2 iMouse;
	void main() {
    		vec2 uv = vUv;
    		uv.x *= iResolution.x / iResolution.y;
		vec3 color = vec3(0.0);
		vec2 mousePos = iMouse / iResolution; // Normalize mouse position
		mousePos.y = 1.0 - mousePos.y; // Invert y-axis for correct UV mapping
		for (int i = 0; i < 128; i++) {
			float pha = sin(float(i) * 546.13 + 1.0) * 0.5 + 0.5;
			float siz = pow(sin(float(i) * 651.74 + 5.0) * 0.5 + 0.5, 4.0);
			float pox = sin(float(i) * 321.55 + 4.1) * iResolution.x / iResolution.y;
			float rad = 0.1 + 0.5 * siz + sin(pha + siz) / 4.0;
			vec2 pos = vec2(
				pox + sin(iTime / 15.0 + pha + siz) + mousePos.x * 2.0 - 1.0,
				-1.0 - rad + (2.0 + 2.0 * rad) * mod(pha + 0.3 * (iTime / 7.0) * (0.2 + 0.8 * siz), 1.0) + mousePos.y
			);
			float dis = length(uv - pos);
			vec3 col = mix(
			vec3(0.194 * sin(iTime / 6.0) + 0.3, 0.2, 0.3 * pha),
			vec3(1.1 * sin(iTime / 9.0) + 0.3, 0.2 * pha, 0.4),
			0.5 + 0.5 * sin(float(i))
			);
			float f = length(uv - pos) / rad;
			f = sqrt(clamp(1.0 + (sin(iTime * siz) * 0.5) * f, 0.0, 1.0));
			color += col.zyx * (1.0 - smoothstep(rad * 0.15, rad, dis));
		}
		color *= sqrt(1.5 - 0.5 * length(uv));
		gl_FragColor = vec4(color, 1.0);
	}`

	const uniforms = {
    	iTime: { value: 0 },
   	 iResolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
    	iMouse: { value: new THREE.Vector2() }, // Add mouse uniform
	};

	const material = new THREE.ShaderMaterial({
	    uniforms: uniforms,
	    vertexShader: vertexShader, // The vertex shader code
	    fragmentShader: fragmentShader // The modified fragment shader code
	})

	var geometry = new THREE.PlaneGeometry(document.documentElement.clientWidth/150,document.documentElement.clientHeight/150);
	var mesh = new THREE.Mesh(geometry, material);
	scene.add(mesh);

	function onWindowResize() {
	    camera.aspect = window.innerWidth / window.innerHeight;
	    camera.updateProjectionMatrix();
	    renderer.setSize(window.innerWidth, window.innerHeight);
	}
	window.addEventListener('resize', onWindowResize, false);

	window.addEventListener('mousemove', (event) => {
   	 uniforms.iMouse.value.set(event.clientX, event.clientY);
	});

function animate(){
	requestAnimationFrame(animate);
//w=w+0.001;
	uniforms.iTime.value += 0.05;

	//uniforms.iMouse.value=w//.set(event.clientX, event.clientY);
//if(w>1000){w=0;}
	renderer.render(scene, camera);
}

animate();


function myFunction(event) {
  var x = event.touches[0].clientX;
  var y = event.touches[0].clientY;
//  alert(x + "  " + y);
uniforms.iMouse.value.set(x, y);
}



</script>
</body>
</html>
